{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/blog/immer-in-100-lines","result":{"data":{"post":{"__typename":"MdxPost","slug":"/blog/immer-in-100-lines","title":"Immer in 100 lines","date":"30.12.2020","tags":[{"name":"SourceCode","slug":"source-code"}],"description":"Immer in 100 lines","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Immer in 100 lines\",\n  \"slug\": \"/blog/immer-in-100-lines\",\n  \"date\": \"2020-12-30T00:00:00.000Z\",\n  \"author\": \"ahabhgk\",\n  \"description\": \"Immer in 100 lines\",\n  \"tags\": [\"SourceCode\"]\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", {\n    \"id\": \"table-of-contents\"\n  }, \"Table of Contents\"), mdx(\"div\", {\n    className: \"table-of-contents\"\n  }, mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#%E5%BA%8F\"\n  }), \"\\u5E8F\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#%E5%8E%9F%E7%90%86\"\n  }), \"\\u539F\\u7406\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#shallowcopy-on-write\"\n  }), \"ShallowCopy on write\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#proxies\"\n  }), \"Proxies\")))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#%E5%AE%9E%E7%8E%B0\"\n  }), \"\\u5B9E\\u73B0\")))), mdx(\"h2\", {\n    \"id\": \"序\"\n  }, \"\\u5E8F\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/immerjs/immer\"\n  }), \"Immer\"), \" - Create the next immutable state by mutating the current one\"), mdx(\"p\", null, \"Immer \\u5B9E\\u73B0\\u7684\\u5C31\\u662F\\u901A\\u8FC7 mutate \\u5F53\\u524D\\u5BF9\\u8C61\\u521B\\u5EFA\\u4E0B\\u4E00\\u4E2A immutable \\u5BF9\\u8C61\\uFF0C\\u6BD4\\u5982\\u6211\\u4EEC\\u5728\\u4F7F\\u7528 React \\u65F6\\u7ECF\\u5E38\\u9047\\u5230 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"memo\"), \" \\u4E2D\\u7684\\u6D45\\u6BD4\\u8F83\\u5224\\u65AD\\u5931\\u8D25\\u5BFC\\u81F4\\u7684\\u4E0D\\u66F4\\u65B0\\u6216\\u591A\\u4F59\\u66F4\\u65B0\\u7684\\u95EE\\u9898\\uFF0C\\u5C31\\u53EF\\u4EE5\\u901A\\u8FC7 immer \\u89E3\\u51B3\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const Profile = memo((props) => {\\n  console.log(\\\"render <Profile />\\\");\\n  return (\\n    <>\\n      <div>Name: {props.user.name}</div>\\n      <div>Age: {props.user.age}</div>\\n    </>\\n  );\\n});\\n\\nconst Blog = memo((props) => {\\n  console.log(\\\"render <Blog />\\\");\\n  return <div>blog: {props.blog.content}</div>;\\n});\\n\\nclass User extends Component {\\n  state = {\\n    user: {\\n      name: \\\"Michel\\\",\\n      age: 33\\n    },\\n    blog: {\\n      content: \\\"hahah...\\\"\\n    }\\n  };\\n\\n  render() {\\n    return (\\n      <div>\\n        <Profile user={this.state.user} />\\n        <Blog blog={this.state.blog} />\\n        <button onClick={this.onUpdateAgeByManual0}>onUpdateAgeByManual0</button>\\n        <button onClick={this.onUpdateAgeByManual1}>onUpdateAgeByManual1</button>\\n        <button onClick={this.onUpdateAgeByManual2}>onUpdateAgeByManual2</button>\\n        <button onClick={this.onUpdateAgeByImmer}>onUpdateAgeByImmer</button>\\n      </div>\\n    );\\n  }\\n\\n  onUpdateAgeByManual0 = () => {\\n    this.setState((prevState) => {\\n      prevState.user.age++;\\n      return {\\n        user: { ...prevState.user },\\n        blog: prevState.blog\\n      };\\n    });\\n  };\\n\\n  onUpdateAgeByManual1 = () => {\\n    this.setState((prevState) => {\\n      prevState.user.age++;\\n      return { ...prevState };\\n    });\\n  };\\n\\n  onUpdateAgeByManual2 = () => {\\n    this.setState((prevState) => {\\n      prevState.user.age++;\\n      return {\\n        user: { ...prevState.user },\\n        blog: { ...prevState.blog }\\n      };\\n    });\\n  };\\n\\n  onUpdateAgeByImmer = () => {\\n    this.setState(\\n      produce(this.state, (draft) => {\\n        draft.user.age += 1;\\n      })\\n    );\\n  };\\n}\\n\")), mdx(\"p\", null, \"\\u53EF\\u4EE5\\u5148\\u731C\\u731C\\u4EE5\\u4E0A\\u4E09\\u79CD onUpdateAgeByManual \\u5206\\u522B\\u4F1A\\u600E\\u6837\\u66F4\\u65B0\\uFF1F\"), mdx(\"details\", null, mdx(\"summary\", null, \"Click me to show the answer...\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"onUpdateAgeByManual0\\uFF1A\\u7406\\u60F3\\u7684\\u66F4\\u65B0\\u72B6\\u6001\\uFF0C\\u53EA\\u4F1A\\u66F4\\u65B0 Profile \\u7EC4\\u4EF6\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"onUpdateAgeByManual1\\uFF1A\\u4E0D\\u4F1A\\u6709\\u7EC4\\u4EF6\\u66F4\\u65B0\\uFF0Cuser \\u5BF9\\u8C61\\u7684\\u5F15\\u7528\\u6CA1\\u53D8\\uFF0Cmemo \\u6D45\\u6BD4\\u8F83\\u540E\\u4E0D\\u4F1A\\u89E6\\u53D1\\u66F4\\u65B0\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"onUpdateAgeByManual2\\uFF1A\\u9020\\u6210\\u591A\\u4F59\\u7684\\u7EC4\\u4EF6\\u66F4\\u65B0\\uFF0Cblog \\u5BF9\\u8C61\\u7684\\u5F15\\u7528\\u6539\\u53D8\\uFF0Cmemo \\u6D45\\u6BD4\\u8F83\\u540E\\u4F1A\\u89E6\\u53D1 Blog \\u7EC4\\u4EF6\\u66F4\\u65B0\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"onUpdateAgeByImmer\\uFF1A\\u540C onUpdateAgeByManual0\"))), mdx(\"p\", null, \"\\u6240\\u4EE5 immutable \\u5BF9\\u8C61\\u6240\\u8981\\u4FDD\\u8BC1\\u7684\\u5C31\\u662F\\u6BCF\\u6B21\\u66F4\\u65B0\\u9700\\u8981\\u4EA7\\u751F\\u4E00\\u4E2A\\u65B0\\u5BF9\\u8C61\\u3002\\u6DF1\\u62F7\\u8D1D\\u5C31\\u662F\\u53EF\\u4EE5\\u6EE1\\u8DB3\\u7684\\uFF0C\\u4F46\\u5982\\u679C\\u8003\\u8651\\u6027\\u80FD\\u95EE\\u9898\\u7684\\u8BDD\\uFF0C\\u5C31\\u9700\\u8981\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"\\u4FDD\\u8BC1\\u5BF9\\u8C61\\u53EA\\u662F\\u53D1\\u751F\\u6539\\u53D8\\u7684\\u5C5E\\u6027\\u4EA7\\u751F\\u65B0\\u7684\\u5F15\\u7528\\uFF0C\\u5176\\u4ED6\\u6CA1\\u53D1\\u751F\\u6539\\u53D8\\u7684\\u5C5E\\u6027\\u4ECD\\u7136\\u4F7F\\u7528\\u65E7\\u7684\\u5F15\\u7528\"), \"\\uFF0C\\u8FD9\\u5C31\\u662F Immer \\u6240\\u5B9E\\u73B0\\u7684\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"32.916666666666664%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAB10lEQVQoz2NgAILYu3fl4h49igCxU/7+ZZy2ciVD3IULTCB+2KNPtmV3VyesfOTvDeIvfp7IuHnNeobplxLA8vMfxnvMfxBrBmIvehrPCKIZ/JYskYq6cCGUAQlo//8Ppn13HHPM3j8lfskhTRtk+Qv/n4LpKadDXLoPRhiD2Ks+JjEzxN67FxB97Zor1KXVgv//c28oK2MB8x88KHLLjBM2XfdGIPz2w/z5T0Oy6vZlss8vv8wKko9/eLeYQfY/y+IzFjJz7sTlgW0I2rDBNmTHDsuEp0/5oq5fN59TVKSxoqdHIX3PHmX/DRtcwvfuVYv++1so88gu5xWrI8Ja9gUrz1k2Qz5101bVgA3rXYP2HlGd/7lKZOLJcPuOo8lSDLF37kwGumx6/IMH4DB6ExhY8tzBQSbszZuy2Bs3OuPvP5im//+/CDAAOJ47+5XOfRJXN+laoHj045dVMTeB8o8eTNO6+p9/73UxwcW3/SsYYm7dkom5cUMK7FwuLobI69f9I8+eFQN7+f599YgTJ7hA7Kjr10TCT5+MBDIZYeEY9+CBetjRE5wgdsKda+KRl64EwgO5CBoJwNiOBlogyYAGgIaLAsM7AcSO3LSEAUP+zh0poAVxAJs00X+2cwvVAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"immutable 对象更新方式\",\n    \"title\": \"immutable 对象更新方式\",\n    \"src\": \"/static/84283ad6cf8e2c6f503bcb0b99cc4389/7d769/immutable.png\",\n    \"srcSet\": [\"/static/84283ad6cf8e2c6f503bcb0b99cc4389/5243c/immutable.png 240w\", \"/static/84283ad6cf8e2c6f503bcb0b99cc4389/ab158/immutable.png 480w\", \"/static/84283ad6cf8e2c6f503bcb0b99cc4389/7d769/immutable.png 960w\", \"/static/84283ad6cf8e2c6f503bcb0b99cc4389/c57e6/immutable.png 1075w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"h2\", {\n    \"id\": \"原理\"\n  }, \"\\u539F\\u7406\"), mdx(\"p\", null, \"\\u6309\\u7167\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://medium.com/hackernoon/introducing-immer-immutability-the-easy-way-9d73d8f71cb3\"\n  }), \"\\u4F5C\\u8005\\u7684\\u8BDD\"), \"\\u6765\\u8BF4\\uFF1A\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Copy on write\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Proxies\")), mdx(\"p\", null, \"produce \\u7684\\u5DE5\\u4F5C\\u5206\\u4E3A\\u4E09\\u4E2A\\u9636\\u6BB5\\uFF0C\\u5206\\u522B\\u4E3A\\u521B\\u5EFA\\u4EE3\\u7406\\uFF08createDraft\\uFF09\\u3001\\u4FEE\\u6539\\u4EE3\\u7406\\uFF08produceDraft\\uFF09\\u3001\\u5B9A\\u7A3F\\uFF08finalize\\uFF09\\uFF0C\\u521B\\u5EFA\\u4EE3\\u7406\\u6240\\u505A\\u7684\\u5C31\\u662F\\u5BF9\\u4F20\\u5165\\u7684\\u7B2C\\u4E00\\u4E2A\\u53C2\\u6570 base \\u5BF9\\u8C61\\u8FDB\\u884C\\u4EE3\\u7406\\uFF0C\\u5B9E\\u73B0\\u540E\\u9762\\u4FEE\\u6539\\u4EE3\\u7406\\u65F6\\uFF0C\\u4E5F\\u5C31\\u662F\\u4F20\\u5165\\u7684\\u56DE\\u8C03\\u51FD\\u6570\\u6267\\u884C\\u65F6\\uFF0C\\u53EF\\u4EE5\\u8FDB\\u884C ShallowCopy on write \\u7684\\u64CD\\u4F5C\\uFF0C\\u6700\\u7EC8\\u5B9A\\u7A3F\\u5C31\\u662F\\u628A\\u8FDB\\u884C\\u4FEE\\u6539\\u7684\\u5BF9\\u8C61\\u7684\\u5F15\\u7528\\u6307\\u5411 ShallowCopy \\u7684\\u5BF9\\u8C61\\u4E0A\\u9762\"), mdx(\"p\", null, \"\\u6240\\u4EE5\\u5173\\u952E\\u539F\\u7406\\u5C31\\u662F\\u5982\\u4F55\\u5B9E\\u73B0 ShallowCopy on write \\u548C\\u5982\\u4F55\\u53BB\\u8FDB\\u884C\\u4EE3\\u7406\"), mdx(\"h3\", {\n    \"id\": \"shallowcopy-on-write\"\n  }, \"ShallowCopy on write\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"544px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"220.41666666666666%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,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')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Copy on write\",\n    \"title\": \"Copy on write\",\n    \"src\": \"/static/1c85aafeb25af2fa635f5c31c0bf319b/b0e00/copy-on-write.png\",\n    \"srcSet\": [\"/static/1c85aafeb25af2fa635f5c31c0bf319b/5243c/copy-on-write.png 240w\", \"/static/1c85aafeb25af2fa635f5c31c0bf319b/ab158/copy-on-write.png 480w\", \"/static/1c85aafeb25af2fa635f5c31c0bf319b/b0e00/copy-on-write.png 544w\"],\n    \"sizes\": \"(max-width: 544px) 100vw, 544px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"p\", null, \"ShallowCopy on write \\u7684\\u539F\\u7406\\u5C31\\u5982\\u4E0A\\u56FE\\uFF0C\\u63A5\\u4E0B\\u6765\\u4E3E\\u4E2A\\u4F8B\\u5B50\\u6765\\u7406\\u89E3\\u8FC7\\u7A0B\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const state = {\\n  user: {\\n    name: \\\"Michel\\\",\\n    age: 33\\n  },\\n  blog: {\\n    content: \\\"hahah...\\\"\\n  }\\n};\\nconst nextState = produce(state, (draft) => {\\n  draft.user.age = draft.user.age + 1;\\n});\\n\")), mdx(\"p\", null, \"\\u5BF9\\u8C61\\u7684\\u7ED3\\u6784\\u5C31\\u50CF\\u4E00\\u68F5\\u6811\\uFF0C\\u57FA\\u672C\\u7C7B\\u578B\\u7684\\u5C5E\\u6027\\u5C31\\u76F8\\u5F53\\u4E8E\\u53F6\\u5B50\\u7ED3\\u70B9\"), mdx(\"p\", null, \"\\u9996\\u5148\\u5728\\u8BFB\\u7684\\u65F6\\u5019\\uFF0C\\u4E5F\\u5C31\\u662F\\u89E6\\u53D1\\u5BF9\\u8C61\\u7684 get \\u64CD\\u4F5C\\u7684\\u65F6\\u5019\\uFF0C\\u4F1A\\u6839\\u636E\\u503C\\u7684\\u7C7B\\u578B\\u8FDB\\u884C\\u4E0D\\u540C\\u7684\\u8FD4\\u56DE\\uFF0C\\u5982\\u679C\\u662F\\u57FA\\u672C\\u7C7B\\u578B\\uFF0C\\u5C31\\u8BF4\\u660E\\u8BBF\\u95EE\\u5230\\u4E86\\u53F6\\u5B50\\u7ED3\\u70B9\\uFF0C\\u76F4\\u63A5\\u8FD4\\u56DE\\u5373\\u53EF\\uFF1B\\u5982\\u679C\\u662F\\u5F15\\u7528\\u7C7B\\u578B\\uFF0C\\u5C31\\u7EE7\\u7EED\\u4E3A\\u8BE5\\u503C\\u521B\\u5EFA\\u4EE3\\u7406\\uFF0C\\u5B9E\\u73B0\\u201C\\u61D2\\u4EE3\\u7406\\u201D\\u3002\\u4F8B\\u5B50\\u4E2D\\u7684 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"draft.user.age + 1\"), \" \\u5C31\\u662F\\u8FDB\\u884C\\u7684\\u8BFB\\uFF0C\\u5148\\u8BFB draft \\u4E0A\\u7684 user\\uFF0C\\u8FD4\\u56DE\\u662F user \\u7684\\u4EE3\\u7406\\uFF0C\\u518D\\u8BFB user \\u4E0A\\u7684 age \\u5C5E\\u6027\\uFF0C\\u8FD4\\u56DE\\u57FA\\u672C\\u7C7B\\u578B 33\\uFF0C\\u518D\\u7ECF\\u8FC7\\u52A0\\u4E00\\u5F97\\u5230\\u7ED3\\u679C 34\"), mdx(\"p\", null, \"\\u7B2C\\u4E00\\u6B21\\u521B\\u5EFA\\u8FC7\\u4EE3\\u7406\\u4E4B\\u540E\\u4F1A\\u8FDB\\u884C\\u5B58\\u50A8\\uFF0C\\u8FD9\\u6837\\u518D\\u6B21\\u8BFB\\u7684\\u65F6\\u5019\\uFF0C\\u5C31\\u53EF\\u4EE5\\u76F4\\u63A5\\u8FD4\\u56DE\\u5B58\\u50A8\\u7684\\u4EE3\\u7406\\uFF0C\\u51CF\\u5C11\\u521B\\u5EFA\\u4EE3\\u7406\\u7684\\u5F00\\u9500\\uFF0C\\u540C\\u65F6\\u4E5F\\u662F\\u5BF9\\u4E8E\\u4EE3\\u7406\\u4E0A\\u7684\\u64CD\\u4F5C\\u8FDB\\u884C\\u7684\\u5B58\\u50A8\\uFF0C\\u4E0D\\u81F3\\u4E8E\\u6BCF\\u6B21\\u90FD\\u521B\\u5EFA\\u65B0\\u7684\\u4EE3\\u7406\\u5BFC\\u81F4\\u4E4B\\u524D\\u4EE3\\u7406\\u4E0A\\u7684\\u64CD\\u4F5C\\u65E0\\u6548\\u3002\\u4F8B\\u5B50\\u4E2D \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"draft.user.age =\"), \" set \\u64CD\\u4F5C\\u4E4B\\u524D\\u90E8\\u5206\\u5C31\\u662F\\u76F8\\u5F53\\u4E8E\\u518D\\u6B21\\u8BFB\\u53D6\\uFF0C\\u5F97\\u5230\\u4E4B\\u524D\\u7684\\u4EE3\\u7406\"), mdx(\"p\", null, \"\\u4E4B\\u540E\\u5728\\u4FEE\\u6539\\u7684\\u65F6\\u5019\\u5C31\\u521B\\u5EFA\\u6D45\\u62F7\\u8D1D\\uFF0C\\u7236\\u8282\\u70B9\\u4E5F\\u8FDB\\u884C\\u6D45\\u62F7\\u8D1D\\uFF0C\\u5E76\\u5728\\u6D45\\u62F7\\u8D1D\\u7684\\u5BF9\\u8C61\\u4E0A\\u8FDB\\u884C\\u4FEE\\u6539\\uFF0C\\u540C\\u65F6 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Object.assign(state.copy, state.drafts)\"), \" \\u628A\\u4E4B\\u524D\\u7684\\u4EE3\\u7406\\u518D\\u5B58\\u5230\\u6D45\\u62F7\\u8D1D\\u5BF9\\u8C61\\u4E0A\\uFF0C\\u540C\\u6837\\u662F\\u4FDD\\u8BC1\\u4E4B\\u524D\\u7684\\u64CD\\u4F5C\\u4E0D\\u5931\\u6548\\u3002\\u4F8B\\u5B50\\u4E2D \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"draft.user.age =\"), \" set \\u64CD\\u4F5C\\u90E8\\u5206\\u5C31\\u89E6\\u53D1\\u4E86 user \\u4EE3\\u7406\\u7684 set \\u64CD\\u4F5C\\uFF0C\\u521B\\u5EFA user \\u7684\\u6D45\\u62F7\\u8D1D\\uFF0C\\u518D\\u5411\\u4E0A\\u521B\\u5EFA draft \\u7684\\u6D45\\u62F7\\u8D1D\\uFF0C\\u4FEE\\u6539 user \\u6D45\\u62F7\\u8D1D\\u5BF9\\u8C61\\u7684 age \\u5C5E\\u6027\"), mdx(\"p\", null, \"\\u6700\\u540E\\u5B9A\\u7A3F\\uFF08finalize\\uFF09\\u65F6\\u5C31\\u662F\\u5BF9\\u5BF9\\u8C61\\u6811\\u8FDB\\u884C\\u904D\\u5386\\uFF0C\\u5982\\u679C\\u53D1\\u73B0\\u4FEE\\u6539\\u4E86\\u4EE3\\u7406\\uFF0C\\u5C31\\u8FD4\\u56DE\\u6D45\\u62F7\\u8D1D\\u5BF9\\u8C61\\uFF1B\\u5982\\u679C\\u6CA1\\u6709\\u4FEE\\u6539\\uFF0C\\u5C31\\u4EC5\\u8FD4\\u56DE\\u539F\\u59CB\\u7684\\u5BF9\\u8C61\"), mdx(\"h3\", {\n    \"id\": \"proxies\"\n  }, \"Proxies\"), mdx(\"p\", null, \"\\u5BF9\\u4E8E\\u5982\\u4F55\\u53BB\\u8FDB\\u884C\\u4EE3\\u7406\\uFF0CImmer \\u4F7F\\u7528\\u7684\\u662F Proxy API \\u4EE3\\u7406\\u7684\\u5BF9\\u8C61\\u548C\\u6570\\u7EC4\\uFF0CMap \\u548C Set \\u5219\\u662F\\u521B\\u5EFA\\u4E86 DraftMap \\u548C DraftSet \\u91CD\\u5199\\u4E86 set\\u3001get\\u3001add\\u3001delete\\u3001has \\u7B49\\u64CD\\u4F5C\\u5B9E\\u73B0\\u7684\\uFF0CES5 \\u73AF\\u5883\\u4F7F\\u7528\\u7684\\u662F defineProperty \\u8FDB\\u884C\\u5BF9\\u8C61\\u548C\\u6570\\u7EC4\\u7684\\u4EE3\\u7406\\uFF0C\\u6240\\u4EE5 Proxy API \\u5E76\\u4E0D\\u662F\\u5FC5\\u987B\\u7684\\uFF0C\\u4EC5\\u4EC5\\u662F\\u65B9\\u4FBF\\u4EE3\\u7406\\u5BF9\\u8C61\\u7684\\u64CD\\u4F5C\\uFF0C\\u6211\\u4EEC\\u4E5F\\u53EF\\u4EE5\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://juejin.cn/post/6878584121510232071#heading-4\"\n  }), \"\\u6307\\u5B9A\\u4E00\\u4E9B\\u65B9\\u6CD5\\u5B9E\\u73B0\\u4EE3\\u7406\\u64CD\\u4F5C\")), mdx(\"h2\", {\n    \"id\": \"实现\"\n  }, \"\\u5B9E\\u73B0\"), mdx(\"p\", null, \"100 \\u884C\\u5DE6\\u53F3\\u7684\\u5B9E\\u73B0\\u53EF\\u4EE5\\u770B \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/ahabhgk/simple-immer\"\n  }), \"ahabhgk/simple-immer\"), \"\\uFF0C\\u5BF9 Immer v1.0.0 \\u505A\\u4E86\\u4E00\\u4E9B\\u7B80\\u5316\\uFF0C\\u539F\\u7406\\u66F4\\u52A0\\u6E05\\u6670\\uFF0C\\u652F\\u6301\\u67EF\\u91CC\\u5316\\u548C\\u5F02\\u6B65\\uFF0C\\u96BE\\u70B9\\u4F1A\\u6709\\u6CE8\\u91CA\\uFF0C\\u4E5F\\u6709\\u6BD4\\u8F83\\u5B8C\\u5584\\u7684\\u6D4B\\u8BD5\\uFF0C\\u5F88\\u5BB9\\u6613\\u4E0A\\u624B\\u8C03\\u8BD5\"), mdx(\"p\", null, \"\\u53E6\\u5916\\u7531\\u4E8E Immer \\u652F\\u6301\\u67EF\\u91CC\\u5316\\uFF0C\\u5F88\\u5BB9\\u6613\\u5C31\\u80FD\\u5B9E\\u73B0 useImmer\\uFF0C\\u53EF\\u4EE5\\u76F4\\u63A5\\u5728 Github \\u4E0A\\u770B\"), mdx(\"p\", null, \"\\u6253\\u7B97\\u6539\\u4E00\\u6539\\u5199\\u4F5C\\u98CE\\u683C\\uFF0C\\u4E4B\\u524D\\u4E09\\u7BC7\\u8BB2 Vue3 \\u7684\\u6587\\u7AE0\\u6709\\u5927\\u6BB5\\u5927\\u6BB5\\u7684\\u8D34\\u4EE3\\u7801\\uFF0C\\u53C8\\u81ED\\u53C8\\u957F\\uFF0C\\u53EA\\u4F1A\\u50AC\\u7720\\u5427\\uFF0C\\u4EE5\\u540E\\u5199\\u7684\\u4F1A\\u5C3D\\u91CF\\u8BB2\\u6E05\\u695A\\u539F\\u7406\\uFF0C\\u5199\\u7684\\u7CBE\\u7B80\\uFF0C\\u9664\\u4E86\\u5F88\\u7CBE\\u70BC\\u7684\\u4F1A\\u8D34\\u4EE3\\u7801\\uFF0C\\u5176\\u4ED6\\u65F6\\u5019\\u6E90\\u7801\\u5C31\\u76F4\\u63A5\\u7ED9\\u94FE\\u63A5\\u4E86\\uFF0C\\u6709\\u7591\\u96BE\\u70B9\\u4F1A\\u901A\\u8FC7\\u6CE8\\u91CA\\u548C\\u6D4B\\u8BD5\\u5199\\u6E05\\u695A\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Table of Contents 序 Immer  - Create the next immutable state by mutating the current one Immer 实现的就是通过 mutate 当前对象创建下一个 immutable…","timeToRead":1,"banner":null}},"pageContext":{"slug":"/blog/immer-in-100-lines","formatString":"DD.MM.YYYY"}},"staticQueryHashes":["318001574","3787687951","3787687951"]}