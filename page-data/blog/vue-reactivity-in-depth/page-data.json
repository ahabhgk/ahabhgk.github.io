{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/blog/vue-reactivity-in-depth","result":{"data":{"post":{"__typename":"MdxPost","slug":"/blog/vue-reactivity-in-depth","title":"Vue Reactivity in Depth","date":"28.08.2020","tags":[{"name":"SourceCode","slug":"source-code"},{"name":"Front End Framework","slug":"front-end-framework"}],"description":"Vue Reactivity in Depth","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Vue Reactivity in Depth\",\n  \"slug\": \"/blog/vue-reactivity-in-depth\",\n  \"date\": \"2020-08-28T00:00:00.000Z\",\n  \"author\": \"ahabhgk\",\n  \"description\": \"Vue Reactivity in Depth\",\n  \"tags\": [\"SourceCode\", \"Front End Framework\"]\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", {\n    \"id\": \"table-of-contents\"\n  }, \"Table of Contents\"), mdx(\"div\", {\n    className: \"table-of-contents\"\n  }, mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#%E5%BA%8F\"\n  }), \"\\u5E8F\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#%EF%B8%8F-reactive\"\n  }), \"\\u2B50\\uFE0F reactive\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#-basehandlers\"\n  }), \"\\uD83C\\uDF25 baseHandlers\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#-effect\"\n  }), \"\\uD83D\\uDE80 effect\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#%EF%B8%8F-collectionhandlers\"\n  }), \"\\u2601\\uFE0F collectionHandlers\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#-ref\"\n  }), \"\\uD83D\\uDCAB ref\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#%EF%B8%8F-computed\"\n  }), \"\\u2604\\uFE0F computed\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#-ramble\"\n  }), \"\\uD83D\\uDE03 ramble\")))), mdx(\"h2\", {\n    \"id\": \"序\"\n  }, \"\\u5E8F\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"46.25%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAByklEQVQoz5WQ205TQRSG94toEA37NO0+dtOWRkiBWImJh/AQQLiApiTSEhIUCHIBIQS8oaggxLbIMbSlYEKV8Cr2HXYyv2tatkSNJl58WbNmzXxrzUjFyle/VP2GUu2a71WvsHf2/+yfX3MCxUr9u1So1P319yVMz8zzzKtZjOdmkc61YrBu5tnb9a/Micjfbn1GsVxvSJ/Kl35m8jW6Tca1uIl2xcB9+U8eyH/ZV0zcvadyIS+cXjaknaNzfyQzBVmLcctMwPWiYEYnXDMKm9DtLjCnC2ErCjXkQdEdKMz9iRqKCDEfnZjG9mGtIW0fnPnD45NgusstJ46QuEwiy4qB2ZR7D2kvAcOIwriRM6prYQ8aNWZmDB2azYfTWWztVwNhFmHmctdNNCU2ySJWHIzycCwJnYSOaCLqXjd0kms0mRDqBD2bj6Rz+CCEHw9r/tDYS+g0tphC6+yBTFPIJNEI3XSbyCwCleoOiRg1k6mxkKn07DttChdD0XAkpD/MzS3h0ZNB3j/wHL2PA54hSfQGpChPtWJQS6aeoo/O9g284FPzy60/3D3+4ucLJ1jJ7/LFtU28Wd34Jwu/5Ytr+ebdd6Uydo4vGj8A3RmEYfzKkx4AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"reactivity\",\n    \"title\": \"reactivity\",\n    \"src\": \"/static/bdcc356a5268ee722f0f0266d390f358/7d769/reactivity.png\",\n    \"srcSet\": [\"/static/bdcc356a5268ee722f0f0266d390f358/5243c/reactivity.png 240w\", \"/static/bdcc356a5268ee722f0f0266d390f358/ab158/reactivity.png 480w\", \"/static/bdcc356a5268ee722f0f0266d390f358/7d769/reactivity.png 960w\", \"/static/bdcc356a5268ee722f0f0266d390f358/baba4/reactivity.png 1346w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"p\", null, \"\\u9996\\u5148\\u4E00\\u8D77\\u5B9E\\u73B0\\u4E00\\u4E2A\\u7B80\\u6613\\u7684 reactivity \\u5427\\uFF0C\\u7A7F\\u63D2\\u7740\\u4F1A\\u63D0\\u5230\\u6E90\\u7801\\u4E2D\\u7684\\u4E00\\u4E9B\\u7EC6\\u8282\\uFF0C\\u5EFA\\u8BAE\\u5148\\u8DDF\\u7740\\u5199\\u5199\\uFF0C\\u7EC6\\u8282\\u53EF\\u4EE5 clone \\u4E0B\\u6765 vue-next \\u6253\\u5F00\\u6E90\\u7801\\u8DDF\\u7740\\u770B\"), mdx(\"h2\", {\n    \"id\": \"️-reactive\"\n  }, \"\\u2B50\\uFE0F reactive\"), mdx(\"p\", null, \"\\u9996\\u5148\\u662F \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"reactive\"), \"\\uFF0C\\u5B83\\u7684\\u4F5C\\u7528\\u662F\\u628A\\u4E00\\u4E2A\\u5BF9\\u8C61\\u53D8\\u6210\\u54CD\\u5E94\\u5F0F\\u5BF9\\u8C61\\uFF0C\\u66F4\\u51C6\\u786E\\u7684\\u8BF4\\u662F \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Object, Array, Map, WeakMap, Set, weakSet\"), \" \\u8FD9\\u51E0\\u79CD\\u5BF9\\u8C61\\u53D8\\u4E3A\\u54CD\\u5E94\\u5F0F\"), mdx(\"p\", null, \"\\u7C7B\\u4F3C\\u4E8E \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"reactive\"), \" \\u4E5F\\u6709 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"readonly\"), \"\\uFF0C\\u5C06\\u4E00\\u4E2A\\u5BF9\\u8C61\\u53D8\\u4E3A\\u4E0D\\u53EF\\u53D8\\u5BF9\\u8C61\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/reactive.js\"\n  }), \"export function reactive(target) {\\n  return createReactiveObject(target, false, mutableHandlers, mutableCollectionHandlers)\\n}\\n\\nexport function readonly(target) {\\n  return createReactiveObject(target, true, readonlyHandlers, readonlyCollectionHandlers)\\n}\\n\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u5B9E\\u9645\\u4E0A\\u662F\\u53EF\\u4EE5 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"readonly(reactive(obj))\"), \" \\u5C06\\u4E00\\u4E2A reactive \\u5BF9\\u8C61\\u8F6C\\u6362\\u4E3A readonly \\u5BF9\\u8C61\\u7684\\uFF0C\\u800C \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"reactive(readonly(obj))\"), \" \\u4ECD\\u7136\\u8FD4\\u56DE readonly \\u5BF9\\u8C61\\uFF0C\\u5B9E\\u73B0\\u662F\\u5728 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"reactive\"), \" \\u5165\\u53E3\\u5224\\u65AD target \\u662F\\u4E0D\\u662F readonly\\uFF0C\\u662F\\u5C31\\u76F4\\u63A5\\u8FD4\\u56DE\\uFF0C\\u800C \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"readonly\"), \" \\u5165\\u53E3\\u4E0D\\u505A\\u5224\\u65AD\\uFF0C\\u53EF\\u4EE5\\u5C06 reactive \\u5BF9\\u8C61\\u5728\\u505A\\u4E00\\u5C42\\u4EE3\\u7406\\uFF0C\\u8F6C\\u6362\\u4E3A readonly\"), mdx(\"pre\", {\n    parentName: \"blockquote\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const original = reactive({ count: 0 })\\nconst copy = readonly(original)\\n\\neffect(() => {\\n  // works for reactivity tracking\\n  console.log(copy.count)\\n})\\n\\n// mutating original will trigger watchers relying on the copy\\noriginal.count++\\n// mutating the copy will fail and result in a warning\\ncopy.count++ // warning!\\n\")), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u5BF9\\u4E8E\\u8FD9\\u79CD\\u60C5\\u51B5\\u662F\\u5728 reactive \\u4EE3\\u7406\\u4E0A\\u5728\\u52A0\\u4E86\\u4E00\\u5C42 readonly \\u4EE3\\u7406\\uFF0C\\u5F53 readonly \\u5BF9\\u8C61\\u7684 get \\u89E6\\u53D1\\u65F6\\u4F1A\\u8C03\\u7528 reactive \\u5BF9\\u8C61\\u7684 get \\u4EE5\\u89E6\\u53D1 track\\uFF0C\\u4E4B\\u540E\\u539F reactive \\u5BF9\\u8C61\\u4FEE\\u6539\\u540E\\u5BF9\\u4E8E readonly \\u5BF9\\u8C61\\u7684 effect \\u5C31\\u4E5F\\u4F1A\\u89E6\\u53D1\")), mdx(\"p\", null, \"\\u8FD9\\u4E24\\u79CD\\u5BF9\\u8C61\\u5B9E\\u73B0\\u662F\\u76F8\\u4F3C\\u7684\\uFF0C\\u6211\\u4EEC\\u901A\\u8FC7 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"createReactiveObject\"), \" \\u521B\\u5EFA\\u8FD9\\u4E24\\u79CD\\u5BF9\\u8C61\\uFF0C\\u4F46\\u5728\\u8FD9\\u4E4B\\u524D\\u6211\\u4EEC\\u5148\\u5B9A\\u4E49\\u4E00\\u4E9B\\u5E38\\u91CF\\u548C\\u5DE5\\u5177\\u51FD\\u6570\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=shared/index.js\"\n  }), \"export const isObject = (value) => typeof value === 'object' && value !== null\\n\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/reactive.js\"\n  }), \"// proxy \\u5B9E\\u4F8B\\u4E0A\\u7684\\u6807\\u8BC6\\nexport const ReactiveFlags = {\\n  IS_REACTIVE: '__v_isReactive',\\n  IS_READONLY: '__v_isReadonly',\\n  RAW: '__v_raw', // \\u539F\\u5BF9\\u8C61\\n}\\n\\nconst TargetType = {\\n  COMMON: 'COMMON', // \\u8868\\u793A Object \\u548C Array\\n  COLLECTION: 'COLLECTION', // \\u8868\\u793A Map\\u3001Set\\u3001WeakMap\\u3001WeakSet\\n  INVALID: 'INVALID', // \\u5176\\u4ED6\\u4E0D\\u5904\\u7406\\u7684\\n}\\n\\n// \\u5224\\u65AD\\u7C7B\\u578B\\nconst getTargetType = (target) => {\\n  const getTypeString = (target) => {\\n    return Object.prototype.toString.call(target).slice(8, -1)\\n  }\\n  const typeString = getTypeString(target)\\n  switch (typeString) {\\n    case 'Object':\\n    case 'Array':\\n      return TargetType.COMMON\\n    case 'Map':\\n    case 'Set':\\n    case 'WeakMap':\\n    case 'WeakSet':\\n      return TargetType.COLLECTION\\n    default:\\n      return TargetType.INVALID\\n  }\\n}\\n\\nexport function toRaw(ob) {\\n  return (ob && toRaw(ob[ReactiveFlags.RAW])) || ob\\n}\\n\")), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ReactiveFlags\"), \" \\u662F proxy \\u4E0A\\u7684\\u4E00\\u4E9B\\u5E38\\u91CF\\u7684\\u5B9A\\u4E49\\u3002\\u5BF9\\u4E8E target \\u7C7B\\u578B\\u7684\\u5224\\u65AD\\uFF0C\\u5728 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"createReactiveObject\"), \" \\u4E2D\\u5BF9\\u4E8E COMMON \\u548C COLLECTION \\u6709\\u4E0D\\u540C\\u7684 handlers \\u6765\\u5904\\u7406\\u3002toRaw \\u7528\\u6765\\u53D6\\u4E00\\u4E2A reactive \\u5BF9\\u8C61\\u7684\\u539F\\u5BF9\\u8C61\\uFF0C\\u901A\\u8FC7\\u9012\\u5F52\\u5B9E\\u73B0\\uFF0C\\u975E\\u5E38\\u5DE7\\u5999\"), mdx(\"p\", null, \"\\u4E0B\\u9762\\u6765\\u770B \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"createReactiveObject\"), \" \\u7684\\u5B9E\\u73B0\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/reactive.js\"\n  }), \"export const reactiveMap = new WeakMap()\\nexport const readonlyMap = new WeakMap()\\n\\nfunction createReactiveObject(target, isReadonly, baseHandlers, collectionHandlers) {\\n  if (!isObject(target)) {\\n    throw new Error(`value cannot be made reactive: ${String(target)}`)\\n  }\\n  if (\\n    target[ReactiveFlags.RAW] && // \\u5DF2\\u7ECF\\u662F reactive \\u6216 readonly \\u5BF9\\u8C61\\n    !(isReadonly && target[ReactiveFlags.IS_REACTIVE]) // \\u6392\\u9664 readonly(reactiveObj) \\u8FD9\\u79CD\\u60C5\\u51B5\\n  ) {\\n    return target\\n  }\\n  // \\u5DF2\\u7ECF\\u6709\\u4E86\\u5BF9\\u5E94\\u7684 proxy\\n  const proxyMap = isReadonly ? readonlyMap : reactiveMap\\n  const existingProxy = proxyMap.get(target)\\n  if (existingProxy) {\\n    return existingProxy\\n  }\\n  // \\u83B7\\u53D6 typeString \\u5224\\u65AD\\u662F\\u4E0D\\u662F collectionType\\uFF08Map\\u3001Set\\u3001WeakMap\\u3001WeakSet\\uFF09\\n  const targetType = getTargetType(target)\\n  if (targetType === TargetType.INVALID) {\\n    return target\\n  }\\n\\n  const observed = new Proxy(\\n    target,\\n    // Map\\u3001Set\\u3001WeakMap\\u3001WeakSet \\u901A\\u8FC7 collectionHandlers \\u4EE3\\u7406\\uFF0CObject\\u3001Array \\u901A\\u8FC7 baseHandlers \\u4EE3\\u7406\\n    targetType === TargetType.COLLECTION ? collectionHandlers : baseHandlers\\n  )\\n  proxyMap.set(target, observed) // \\u5B58\\u5BF9\\u5E94 proxy\\n  return observed\\n}\\n\")), mdx(\"p\", null, \"\\u53EF\\u4EE5\\u770B\\u5230\\u901A\\u8FC7\\u4E24\\u4E2A WeakMap \\u6765\\u5B58\\u5BF9\\u8C61\\u5BF9\\u5E94\\u7684 reactive \\u5B9E\\u4F8B\\u548C readonly \\u5B9E\\u4F8B\\uFF0C\\u518D\\u6B21\\u8C03\\u7528\\u65F6\\u5C31\\u53EF\\u4EE5\\u76F4\\u63A5\\u8FD4\\u56DE\"), mdx(\"p\", null, \"\\u7136\\u540E\\u901A\\u8FC7 Proxy \\u8FDB\\u884C\\u4EE3\\u7406\\uFF0C\\u6211\\u4EEC\\u5148\\u770B\\u5BF9\\u4E8E Object \\u548C Array \\u7684\\u4EE3\\u7406 mutableHandlers \\u548C readonlyHandlers\"), mdx(\"h2\", {\n    \"id\": \"-basehandlers\"\n  }, \"\\uD83C\\uDF25 baseHandlers\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/baseHandlers.js\"\n  }), \"const get = createGetter()\\nconst readonlyGet = createGetter(true)\\n\\nconst set = createSetter()\\n\\nexport const mutableHandlers = {\\n  get,\\n  set,\\n  deleteProperty,\\n  has,\\n  ownKeys,\\n}\\n\\nexport const readonlyHandlers = {\\n  get: readonlyGet,\\n  set(target, key) {\\n    console.warn(\\n      `Set operation on key \\\"${String(key)}\\\" failed: target is readonly.`,\\n      target\\n    )\\n    return true\\n  },\\n  deleteProperty(target, key) {\\n    console.warn(\\n      `Delete operation on key \\\"${String(key)}\\\" failed: target is readonly.`,\\n      target\\n    )\\n    return true\\n  },\\n}\\n\")), mdx(\"p\", null, \"\\u53EF\\u4EE5\\u770B\\u5230 readonly \\u4E0E reactive \\u7684\\u4E0D\\u540C\\u5C31\\u5728\\u4E8E readonly \\u4EE3\\u7406\\u7684\\u4FEE\\u6539\\u64CD\\u4F5C\\uFF0C\\u4FEE\\u6539\\u65F6\\u4E0D\\u4F1A\\u771F\\u6B63\\u53BB\\u4FEE\\u6539\\u5BF9\\u8C61\\uFF0C\\u5E76\\u5728\\u5F00\\u53D1\\u6A21\\u5F0F\\u4E0B\\u62A5\\u8B66\\u544A\\uFF1Breadonly \\u4EE3\\u7406\\u7684 get\\u3001has\\u3001ownKeys \\u64CD\\u4F5C\\u4E0D\\u4F1A\\u53BB track \\u6536\\u96C6\\u4F9D\\u8D56\\uFF0Cget \\u6BD4\\u8F83\\u7279\\u6B8A\\uFF0Chas\\u3001ownKeys \\u53EF\\u4EE5\\u76F4\\u63A5\\u7528\\u539F\\u5BF9\\u8C61\\u64CD\\u4F5C\\u5C31\\u4E0D\\u4F1A track\\uFF0C\\u76F4\\u63A5\\u4E0D\\u52A0\\u5373\\u53EF\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u545C\\u545C\\u545C\\uFF5E \\u6211\\u7684 PR \\u6CA1\\u88AB merge\\uFF1A\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/vuejs/vue-next/pull/2002\"\n  }), \"PR: readonly object should not track on 'has' and 'ownKeys'\"))), mdx(\"p\", null, \"\\u5BF9\\u4E8E get\\u3001readonlyGet \\u548C set \\u5219\\u662F\\u901A\\u8FC7 createGetter \\u548C createSetter \\u521B\\u5EFA\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/baseHandlers.js\",\n    \"metastring\": \"{13,15,26}\",\n    \"{13,15,26}\": true\n  }), \"function createGetter(isReadonly = false) {\\n  return function get(target, key, receiver) {\\n    if (key === ReactiveFlags.IS_REACTIVE) return !isReadonly\\n    if (key === ReactiveFlags.IS_READONLY) return isReadonly\\n    if (\\n      key === ReactiveFlags.RAW &&\\n      receiver === (isReadonly ? readonlyMap : reactiveMap).get(target)\\n    ) {\\n      return target\\n    }\\n\\n    const res = Reflect.get(target, key, receiver)\\n    if (!isReadonly) track(target, TrackOpTypes.GET, key)\\n    if (isObject(res)) {\\n      return isReadonly ? readonly(res) : reactive(res)\\n    }\\n    return res\\n  }\\n}\\n\\nfunction createSetter() {\\n  return function set(target, key, value, receiver) {\\n    const oldValue = target[key]\\n    const res = Reflect.set(target, key, value, receiver)\\n    if (target === receiver[ReactiveFlags.RAW] && hasChanged(value, oldValue)) {\\n      trigger(target, TriggerOpTypes.SET, key)\\n    }\\n    return res\\n  }\\n}\\n\")), mdx(\"p\", null, \"\\u8FD9\\u4E24\\u4E2A\\u51FD\\u6570\\u901A\\u8FC7 isReadonly \\u7684\\u4E0D\\u540C\\u521B\\u5EFA\\u4E0D\\u540C\\u7684 getter \\u548C setter\\uFF0C\\u5F62\\u6210\\u95ED\\u5305\\u5B58 isReadonly \\u7684\\u503C\\uFF0C\\u8FD4\\u56DE\\u7684 getter \\u4EE3\\u7406 reactive \\u5BF9\\u8C61\\u548C readonly \\u5BF9\\u8C61\\u7684 get \\u64CD\\u4F5C\\uFF0C\\u5F53 key \\u662F \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"__v_isReactive\"), \"\\u3001\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"__v_raw\"), \"\\u3001\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"__v_isReadonly\"), \" \\u8FD9\\u51E0\\u4E2A ReactiveFlags \\u5E38\\u91CF\\u65F6\\uFF0C\\u5C31\\u76F4\\u63A5\\u901A\\u8FC7\\u53C2\\u6570\\u8FD4\\u56DE\\u5BF9\\u5E94\\u7684\\u7ED3\\u679C\\uFF0C\\u6240\\u4EE5\\u8FD9\\u51E0\\u4E2A\\u5E38\\u91CF\\u5E76\\u6CA1\\u6709\\u6302\\u8F7D\\u5728 proxy \\u5B9E\\u4F8B\\u4E0A\\uFF0C\\u800C\\u662F\\u901A\\u8FC7\\u4EE3\\u7406 get \\u64CD\\u4F5C\\u5B9E\\u73B0\\uFF0C\\u4FDD\\u8BC1\\u4E86 proxy \\u5B9E\\u4F8B\\u4E0A\\u6CA1\\u6709\\u591A\\u4F59\\u7684\\u5C5E\\u6027\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"setter \\u5E76\\u6CA1\\u6709\\u4F20 isReadonly\\uFF0C\\u8FD9\\u91CC\\u5B9E\\u9645\\u4E0A\\u5E76\\u4E0D\\u9700\\u8981 createSetter \\u5B9E\\u73B0\\uFF0C\\u4F46\\u5728\\u6E90\\u7801\\u4E2D\\u8FD8\\u6709 shallowReactive \\u7684\\u60C5\\u51B5\\uFF0C\\u9700\\u8981\\u5224\\u65AD isShallow\\uFF0C\\u8FD9\\u91CC\\u4E3A\\u4E86\\u7CBE\\u7B80\\u7701\\u7565\\u4E86 shallow \\u5BF9\\u5E94\\u7684\\u5B9E\\u73B0\")), mdx(\"p\", null, \"\\u4E4B\\u540E\\u5C31\\u662F\\u4EE3\\u7406\\u540E\\u4E3B\\u8981\\u7684\\u64CD\\u4F5C\\u4E86\\uFF0C\\u9996\\u5148\\u901A\\u8FC7 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Reflect.get\"), \" \\u53D6\\u5F97 value\\uFF0C\\u7136\\u540E\\u8FDB\\u884C track\\uFF0C\\u4E5F\\u5C31\\u662F\\u4F9D\\u8D56\\u6536\\u96C6\\uFF0Ctrack \\u5176\\u5B9E\\u662F\\u5B9E\\u73B0\\u54CD\\u5E94\\u5F0F\\u7684\\u524D\\u534A\\u90E8\\u5206\\uFF0C\\u540E\\u534A\\u90E8\\u5206\\u5C31\\u662F trigger \\u89E6\\u53D1\\u4F9D\\u8D56\"), mdx(\"p\", null, \"\\u6700\\u540E\\u5224\\u65AD value \\u662F\\u5426\\u662F\\u5BF9\\u8C61\\uFF0C\\u5982\\u679C\\u662F\\u5C31\\u8FDB\\u884C\\u5BF9\\u5E94\\u7684 reactive \\u6216 readonly\\uFF0C\\u8FD9\\u6837\\u5728\\u7ED3\\u679C\\u5904\\u8FDB\\u884C\\u54CD\\u5E94\\u5F0F\\uFF0Clazy \\u7684\\u8FDB\\u884C\\u6DF1\\u5EA6\\u9012\\u5F52\\uFF0C\\u5B9E\\u73B0\\u6DF1\\u5EA6\\u54CD\\u5E94\\u5F0F\\u7684\\u540C\\u65F6\\uFF0C\\u4E5F\\u9632\\u6B62\\u4E86\\u5FAA\\u73AF\\u5F15\\u7528\\u5BFC\\u81F4\\u7684\\u65E0\\u9650\\u9012\\u5F52\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Proxy \\u7684\\u4EE3\\u7406\\u53EA\\u80FD\\u4EE3\\u7406\\u4E00\\u5C42\\uFF0C\\u662F\\u6D45\\u7684\\uFF0Creactive \\u5B9E\\u73B0\\u7684\\u662F\\u6DF1\\u5EA6\\u54CD\\u5E94\\u5F0F\"), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u6E90\\u7801\\u4E2D reactive Object get \\u53D6\\u51FA\\u6765\\u5982\\u679C\\u662F ref \\u4F1A\\u81EA\\u52A8\\u8FD4\\u56DE value\\uFF0Creactive Array \\u5219\\u4E0D\\u4F1A\\uFF0C\\u8BE6\\u7EC6\\u53EF\\u4EE5\\u770B\\u770B \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/vuejs/vue-next/issues/737\"\n  }), \"Issues: Stable mutation of reactive arrays containing refs\")), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u6E90\\u7801\\u4E2D arrayInstrumentations \\u7684\\u539F\\u56E0\\u53EF\\u4EE5\\u770B\\u8FD9\\u4E2A \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/vuejs/vue-next/commit/aefb7d282ed716923ca1a288a63a83a94af87ebc#diff-29cbe9d04db941aad894beed12b88ff1\"\n  }), \"commit \\u7684 test case\"))), mdx(\"p\", null, \"setter \\u4EE3\\u7406\\u64CD\\u4F5C\\u4E5F\\u7C7B\\u4F3C\\uFF0C\\u5148\\u901A\\u8FC7 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Reflect.set\"), \" \\u5F97\\u5230 set \\u7684\\u7ED3\\u679C\\uFF0C\\u7136\\u540E trigger \\u89E6\\u53D1\\u4F9D\\u8D56\\uFF0C\\u6700\\u540E\\u8FD4\\u56DE\\u7ED3\\u679C\\uFF0C\\u8FD9\\u91CC\\u4E00\\u5B9A\\u8981\\u5148\\u6267\\u884C set \\u540E\\u518D trigger\\uFF0Ceffect \\u4E2D\\u53EF\\u80FD\\u6709\\u64CD\\u4F5C\\u4F9D\\u8D56\\u4E8E set \\u540E\\u7684\\u5BF9\\u8C61\\uFF0C\\u5148 set \\u80FD\\u4FDD\\u8BC1 effect \\u4E2D\\u7684\\u51FD\\u6570\\u6267\\u884C\\u51FA\\u6B63\\u786E\\u7684\\u7ED3\\u679C\"), mdx(\"p\", null, \"\\u5176\\u4ED6\\u7684 deleteProperty\\u3001has\\u3001ownKeys \\u4E5F\\u7C7B\\u4F3C\\uFF0C\\u5F97\\u5230\\u7ED3\\u679C\\u7136\\u540E\\u89E6\\u53D1 track \\u6216 trigger\\uFF0C\\u6700\\u540E\\u8FD4\\u56DE\\u7ED3\\u679C\\u3002deleteProperty \\u7C7B\\u4F3C set \\u4F1A\\u89E6\\u53D1\\u4F9D\\u8D56\\u6BD4\\u8F83\\u597D\\u7406\\u89E3\\uFF0C\\u90A3 has\\u3001ownKeys \\u4E3A\\u4EC0\\u4E48\\u4F1A\\u6536\\u96C6\\u4F9D\\u8D56\\u5462\\uFF1F\\u56E0\\u4E3A\\u6709\\u65F6\\u9700\\u8981\\u5224\\u65AD proxy \\u662F\\u5426\\u6709 key \\u5C5E\\u6027\\uFF0C\\u6216\\u8005\\u4F9D\\u8D56\\u4E8E proxy \\u7684 keys \\u7B49\\u60C5\\u51B5\\uFF0C\\u5728\\u65B0\\u589E\\u548C\\u5220\\u9664 key \\u65F6\\u5C31\\u9700\\u8981\\u89E6\\u53D1\\u5BF9\\u5E94\\u7684 effect\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"effect(() => console.log(Object.keys(proxy)))\\neffect(() => console.log(key in proxy))\\n\")), mdx(\"p\", null, \"\\u4EE3\\u7406 ownKeys \\u65F6\\u53EA\\u6709\\u4E00\\u4E2A target \\u53C2\\u6570\\uFF0CownKeys \\u7684\\u64CD\\u4F5C\\u5E76\\u4E0D\\u9700\\u8981 key\\uFF0C\\u4F46\\u662F track \\u548C trigger \\u81F3\\u5C11\\u9700\\u8981 target \\u548C\\u5BF9\\u5E94\\u7684 key \\u4EE5\\u627E\\u5230\\u4F9D\\u8D56\\uFF0C\\u8FD9\\u65F6\\u53EF\\u4EE5\\u5B9A\\u4E49\\u4E00\\u4E2A \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ITERATE_KEY\"), \" \\u5E38\\u91CF\\uFF0C\\u4E13\\u95E8\\u5904\\u7406\\u8FD9\\u79CD\\u904D\\u5386\\u800C\\u4E0D\\u9700\\u8981 key \\u7684\\u60C5\\u51B5\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/baseHandlers.js\"\n  }), \"export const ITERATE_KEY = Symbol('iterate')\\n\\nfunction ownKeys(target) {\\n  track(target, TrackOpTypes.ITERATE, ITERATE_KEY)\\n  return Reflect.ownKeys(target)\\n}\\n\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u6240\\u4EE5\\u4EC0\\u4E48\\u662F\\u54CD\\u5E94\\u5F0F\\u5BF9\\u8C61\\u5462\\uFF1F\\u4E2A\\u4EBA\\u7406\\u89E3\\u54CD\\u5E94\\u5F0F\\u5BF9\\u8C61\\u4E0E\\u666E\\u901A\\u5BF9\\u8C61\\u7684\\u533A\\u522B\\u5C31\\u5728\\u4E8E\\u54CD\\u5E94\\u5F0F\\u5BF9\\u8C61\\u7684\\u64CD\\u4F5C\\u53EF\\u4EE5\\u901A\\u8FC7 proxy \\u4EE3\\u7406\\u4EE5\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"\\u8C03\\u7528 track \\u6536\\u96C6\\u4F9D\\u8D56\\u6216\\u8C03\\u7528 trigger \\u89E6\\u53D1\\u4F9D\\u8D56\"))), mdx(\"h2\", {\n    \"id\": \"-effect\"\n  }, \"\\uD83D\\uDE80 effect\"), mdx(\"p\", null, \"\\u4E0A\\u9762\\u63D0\\u5230\\u5F88\\u591A\\u6B21\\u4F9D\\u8D56\\u6536\\u96C6\\u548C\\u89E6\\u53D1\\u4F9D\\u8D56\\u4E86\\uFF0C\\u90A3\\u5230\\u5E95\\u4EC0\\u4E48\\u662F\\u4F9D\\u8D56\\u5462\\uFF1F\\u4F9D\\u8D56\\u5176\\u5B9E\\u5C31\\u662F effect \\u51FD\\u6570\\uFF0C\\u6211\\u4EEC\\u5148\\u770B track \\u7684\\u5B9E\\u73B0\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/effect.js\",\n    \"metastring\": \"{19,20}\",\n    \"{19,20}\": true\n  }), \"const targetMap = new WeakMap()\\n\\nlet activeEffect\\n\\nexport function track(target, type, key) {\\n  if (activeEffect == null) return\\n\\n  let depsMap = targetMap.get(target)\\n  if (!depsMap) {\\n    targetMap.set(target, (depsMap = new Map()))\\n  }\\n\\n  let dep = depsMap.get(key)\\n  if (!dep) {\\n    depsMap.set(key, (dep = new Set()))\\n  }\\n\\n  if (!dep.has(activeEffect)) {\\n    dep.add(activeEffect)\\n    activeEffect.deps.push(dep)\\n  }\\n}\\n\")), mdx(\"p\", null, \"\\u9996\\u5148\\u5224\\u65AD\\u5F53\\u524D\\u7684 activeEffect \\u6709\\u6CA1\\u6709\\uFF0C\\u6CA1\\u6709\\u5C31\\u76F4\\u63A5\\u8FD4\\u56DE\\uFF0C\\u4E4B\\u540E\\u901A\\u8FC7 targetMap \\u62FF\\u5230 target \\u5BF9\\u5E94\\u7684 depsMap\\uFF0C\\u518D\\u901A\\u8FC7 depsMap \\u62FF\\u5230 key \\u5BF9\\u5E94\\u7684 dep\\uFF0Cdep \\u662F\\u4E00\\u4E2A Set\\uFF0C\\u5B58\\u50A8 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"target.key\"), \" \\u9700\\u8981\\u7684 effect \\u4F9D\\u8D56\\uFF0C\\u800C effect \\u53C8\\u901A\\u8FC7 deps \\u6570\\u7EC4\\u5B58\\u50A8\\u4F9D\\u8D56\\u4E8E effect \\u7684\\u6240\\u6709 dep\\uFF0C\\u5EFA\\u7ACB\\u4E00\\u4E2A\\u53CC\\u5411\\u7684\\u6536\\u96C6\\uFF0Cdep \\u5230 effect \\u662F\\u4E3A\\u4E86 trigger \\u4F7F\\u7528\\uFF0C\\u800C effect \\u5230 dep \\u662F\\u4E3A\\u4E86 effect \\u8C03\\u7528\\u65F6\\u627E\\u5230\\u4F9D\\u8D56\\u4E8E\\u8FD9\\u4E2A effect \\u6240\\u6709 dep\\uFF0C\\u4ECE dep \\u4E2D\\u5220\\u9664\\u8FD9\\u4E2A\\u8C03\\u7528\\u8FC7\\u7684 effect\\uFF0C\\u7528\\u6765\\u6E05\\u9664\\u4E0A\\u4E00\\u8F6E\\u7684\\u4F9D\\u8D56\\uFF0C\\u9632\\u6B62\\u672C\\u8F6E\\u89E6\\u53D1\\u591A\\u4F59\\u7684\\u4F9D\\u8D56\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/effect.js\",\n    \"metastring\": \"{4,21-29}\",\n    \"{4,21-29}\": true\n  }), \"export function effect(fn, options = {}) {\\n  const effect = createReactiveEffect(fn, options)\\n  if (!options.lazy) {\\n    effect()\\n  }\\n  return effect\\n}\\n\\n// \\u505C\\u6B62\\u76D1\\u542C\\nexport function stop(effect) {\\n  if (effect.active) {\\n    cleanup(effect)\\n    effect.active = false\\n  }\\n}\\n\\nfunction createReactiveEffect(fn, options) {\\n  const effect = function reactiveEffect() {\\n    if (!effect.active) return effect.options.scheduler ? undefined : fn()\\n    if (!effectStack.includes(effect)) {\\n      cleanup(effect) // effect \\u8C03\\u7528\\u65F6\\u4F1A\\u6E05\\u9664\\u4E0A\\u4E00\\u8F6E\\u7684\\u4F9D\\u8D56\\uFF0C\\u9632\\u6B62\\u672C\\u8F6E\\u89E6\\u53D1\\u591A\\u4F59\\u7684\\u4F9D\\u8D56\\n      try {\\n        effectStack.push(effect) // \\u53EF\\u80FD\\u6709 effect \\u4E2D\\u8C03\\u7528\\u53E6\\u4E00\\u4E2A effect \\u7684\\u60C5\\u51B5\\uFF0C\\u6A21\\u62DF\\u4E00\\u4E2A\\u6808\\u6765\\u5904\\u7406\\n        activeEffect = effect\\n        return fn() // let value = effect() \\u5C06\\u51FD\\u6570\\u7684\\u7ED3\\u679C\\u8FD4\\u56DE\\uFF0C\\u53EF\\u4EE5\\u4ECE\\u5916\\u9762\\u53BB\\u5230\\u7ED3\\u679C\\n      } finally {\\n        effectStack.pop()\\n        activeEffect = effectStack[effectStack.length - 1]\\n      }\\n    }\\n  }\\n  effect.active = true // active \\u5224\\u65AD effect \\u662F\\u5426\\u8FD8\\u6D3B\\u7740\\uFF0Cstop(effect) \\u540E active \\u5C31\\u662F false\\n  effect.deps = [] // \\u6536\\u96C6\\u5BF9\\u5E94\\u7684 dep\\uFF0Ccleanup \\u65F6\\u4EE5\\u627E\\u5230 dep\\uFF0C\\u4ECE dep \\u4E2D\\u6E05\\u9664 effect\\n  effect.options = options // \\u5B58\\u653E onTrack\\u3001onTrigger\\u3001onStop \\u7B49\\u94A9\\u5B50\\u51FD\\u6570\\uFF0C\\u4E3A\\u4E86\\u7CBE\\u7B80\\u6211\\u4EEC\\u53EA\\u5B9E\\u73B0 scheduler\\n  return effect\\n}\\n\\nfunction cleanup(effect) {\\n  const { deps } = effect\\n  deps.forEach(dep => dep.delete(effect)) // deps \\u4E2D\\u7684 dep \\u6E05 effect\\n  deps.length = 0 // \\u6E05\\u7A7A effect \\u7684 deps\\n}\\n\")), mdx(\"p\", null, \"\\u53EF\\u4EE5\\u770B\\u5230 effect API \\u4F20\\u5165\\u4E00\\u4E2A\\u51FD\\u6570\\uFF0Ceffect API \\u901A\\u8FC7 createReactiveEffect \\u521B\\u5EFA\\u4E00\\u4E2A effect \\u51FD\\u6570\\uFF0C\\u5E76\\u8FD4\\u56DE\\u8FD9\\u4E2A\\u51FD\\u6570\\uFF0C\\u8FD9\\u4E2A\\u51FD\\u6570\\u7684\\u8FD4\\u56DE\\u503C\\u5C31\\u662F\\u4F20\\u5165 effect API \\u51FD\\u6570\\u7684\\u7ED3\\u679C\\uFF0C\\u53EA\\u4E0D\\u8FC7\\u5728\\u8C03\\u7528 effect \\u51FD\\u6570\\u65F6\\u4F1A\\u628A activeEffect \\u8D4B\\u503C\\u4E3A\\u5F53\\u524D\\u8FD9\\u4E2A\\u8C03\\u7528\\u4E2D\\u7684 effect\\uFF0C\\u5E76\\u5728\\u8C03\\u7528\\u7ED3\\u675F\\u540E\\u628A activeEffect \\u6539\\u56DE\\u53BB\"), mdx(\"p\", null, \"effect \\u51FD\\u6570\\u521B\\u5EFA\\u540E\\u5982\\u679C\\u4E0D\\u662F lazy \\u7684\\u4F1A\\u9996\\u5148\\u6267\\u884C\\u4E00\\u6B21\\uFF0C\\u8FD9\\u6B21\\u6267\\u884C\\u662F\\u4E3A\\u4E86\\u8C03\\u7528 fn\\uFF0C\\u89E6\\u53D1 get \\u7B49\\u4EE3\\u7406\\uFF0C\\u4EE5\\u5148\\u6536\\u96C6\\u4E00\\u904D\\u4F9D\\u8D56\\uFF0C\\u5148 track \\u4E86\\u4E4B\\u540E\\u518D trigger \\u624D\\u80FD\\u6709\\u4F9D\\u8D56\\u6765\\u89E6\\u53D1\\uFF0C\\u5982\\u679C options \\u4F20\\u5165\\u4E86 lazy \\u4E3A true\\uFF0C\\u5C31\\u9700\\u8981\\u4FDD\\u8BC1\\u5148\\u624B\\u52A8\\u6267\\u884C\\u4E00\\u904D effect \\u51FD\\u6570\\u6765\\u6536\\u96C6\\u4F9D\\u8D56\"), mdx(\"p\", null, \"effect API \\u5176\\u5B9E\\u662F\\u4E00\\u4E2A\\u6BD4\\u8F83\\u5E95\\u5C42\\u7684\\u51FD\\u6570\\uFF0C\\u6211\\u4EEC\\u5E73\\u65F6\\u4F7F\\u7528\\u90FD\\u662F\\u7528 watchEffect \\u548C watch\\uFF0C\\u8FD9\\u4E24\\u4E2A\\u90FD\\u662F\\u57FA\\u4E8E effect \\u5B9E\\u73B0\\u7684\\uFF0C\\u6BD4\\u5982\\u8C03\\u7528\\u8FD9\\u4E24\\u4E2A\\u51FD\\u6570\\u8FD4\\u56DE\\u7684\\u662F\\u4E00\\u4E2A stop \\u51FD\\u6570\\u7528\\u6765\\u505C\\u6B62\\u76D1\\u542C\\uFF0C\\u5176\\u5B9E\\u5C31\\u662F\\u5BF9\\u4E0A\\u9762\\u7684\\u4E00\\u4E2A\\u5C01\\u88C5\\uFF0C\\u4F46\\u4E3A\\u4EC0\\u4E48 effect API \\u4E0D\\u76F4\\u63A5\\u8FD4\\u56DE\\u4E00\\u4E2A stop \\u51FD\\u6570\\uFF0C\\u800C\\u662F\\u8FD4\\u56DE\\u4E00\\u4E2A effect \\u51FD\\u6570\\uFF1F\\u56E0\\u4E3A effect \\u51FD\\u6570\\u53EF\\u4EE5\\u53D6\\u4F20\\u5165\\u51FD\\u6570\\u7684\\u7ED3\\u679C\\uFF0C\\u5176\\u4ED6\\u4E00\\u4E9B API \\u7684\\u5B9E\\u73B0\\u9700\\u8981\\u8FD9\\u4E2A\\u7ED3\\u679C\\uFF0C\\u6240\\u4EE5 effect API \\u548C stop \\u51FD\\u6570\\u8BBE\\u8BA1\\u6210\\u4E86\\u5206\\u5F00\\u7684\"), mdx(\"p\", null, \"\\u4E0B\\u9762\\u6211\\u4EEC\\u770B trigger \\u7684\\u5B9E\\u73B0\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/effect.js\",\n    \"metastring\": \"{6,29-33}\",\n    \"{6,29-33}\": true\n  }), \"export function trigger(target, type, key) {\\n  const depsMap = targetMap.get(target)\\n  if (!depsMap) return\\n  // \\u9700\\u8981\\u65B0\\u5EFA\\u4E00\\u4E2A set\\uFF0C\\u5982\\u679C\\u76F4\\u63A5 const effect = depsMap.get(key)\\n  // effect \\u51FD\\u6570\\u6267\\u884C\\u65F6 track \\u7684\\u4F9D\\u8D56\\u5C31\\u4E5F\\u4F1A\\u5728\\u8FD9\\u4E00\\u8F6E trigger \\u6267\\u884C\\uFF0C\\u5BFC\\u81F4\\u65E0\\u9650\\u5FAA\\u73AF\\n  const effects = new Set()\\n  const add = (effectsToAdd) => {\\n    if (effectsToAdd) {\\n      effectsToAdd.forEach(effect => {\\n        // \\u4E0D\\u8981\\u6DFB\\u52A0\\u81EA\\u5DF1\\u5F53\\u524D\\u7684 effect\\uFF0C\\u5426\\u5219\\u4E4B\\u540E run\\uFF08mutate\\uFF09\\u7684\\u65F6\\u5019\\n        // \\u9047\\u5230 effect(() => foo.value++) \\u4F1A\\u5BFC\\u81F4\\u65E0\\u9650\\u5FAA\\u73AF\\n        if (effect !== activeEffect) effects.add(effect)\\n      })\\n    }\\n  }\\n  // SET | ADD | DELETE\\n  if (key !== undefined) {\\n    add(depsMap.get(key))\\n  }\\n  const shouldTriggerIteration =\\n    (type === TriggerOpTypes.ADD) ||\\n    (type === TriggerOpTypes.DELETE)\\n  // iteration key on ADD | DELETE\\n  if (shouldTriggerIteration) {\\n    add(depsMap.get(isArray(target) ? 'length' : ITERATE_KEY))\\n  }\\n\\n  effects.forEach((effect) => {\\n    if (effect.options.scheduler) {\\n      effect.options.scheduler(effect)\\n    } else {\\n      effect()\\n    }\\n  })\\n}\\n\")), mdx(\"p\", null, \"\\u4E5F\\u5F88\\u597D\\u7406\\u89E3\\uFF0C\\u5C31\\u662F\\u65B0\\u5EFA\\u4E00\\u4E2A Set\\uFF0C\\u5B58\\u901A\\u8FC7 targetMap \\u548C depsMap \\u62FF\\u5230\\u7684\\u4F9D\\u8D56\\uFF08effect \\u51FD\\u6570\\uFF09\\uFF0C\\u8981\\u6CE8\\u610F\\u4E0D\\u80FD\\u5C06\\u5F53\\u524D\\u7684 activeEffect \\u6DFB\\u52A0\\u8FDB\\u53BB\\uFF0C\\u5426\\u5219\\u53EF\\u80FD\\u4F1A\\u65E0\\u9650\\u5FAA\\u73AF\\uFF0C\\u540C\\u65F6\\u9488\\u5BF9\\u89E6\\u53D1 trigger \\u7684\\u4E0D\\u540C\\u65B9\\u5F0F\\uFF08type\\uFF09\\u4E5F\\u6709\\u4E0D\\u540C\\u7684\\u6DFB\\u52A0\\u65B9\\u5F0F\\uFF0C\\u6BD4\\u5982\\u5728\\u65B0\\u589E\\u6216\\u5220\\u9664 key \\u5BFC\\u81F4 trigger \\u65F6\\u9700\\u8981\\u628A length \\u6216 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ITERATE_KEY\"), \" \\u7684\\u4F9D\\u8D56\\u4E5F\\u6DFB\\u52A0\\u8FDB\\u53BB\\uFF0C\\u5BF9\\u5E94\\u4E0A\\u9762 track \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ITERATE_KEY\"), \"\\uFF0C\\u6700\\u540E\\u4F9D\\u6B21\\u6267\\u884C\\u5373\\u53EF\"), mdx(\"p\", null, \"\\u4E3A\\u4EC0\\u4E48\\u9700\\u8981\\u65B0\\u5EFA\\u4E00\\u4E2A Set\\uFF0C\\u800C\\u4E0D\\u76F4\\u63A5\\u7528 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"targetMap.get(target).get(key).forEach(run)\"), \" \\u5462\\uFF1F\\u56E0\\u4E3A effect \\u51FD\\u6570\\u5728\\u6267\\u884C\\u7684\\u8FC7\\u7A0B\\u4E2D\\u4F1A\\u7EE7\\u7EED track \\u5411 depsMap \\u7684 dep \\u4E2D\\u6DFB\\u52A0\\u4F9D\\u8D56\\uFF0C\\u5BFC\\u81F4\\u8FD9\\u91CC\\u4E00\\u76F4 trigger effect\\uFF0Ceffect \\u4E2D\\u53C8\\u4E00\\u76F4 track\\uFF0C\\u65E0\\u9650\\u5FAA\\u73AF\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u4E3A\\u4EC0\\u4E48\\u4E0D\\u80FD\\u89E3\\u6784\\uFF1F\\u7531\\u4E8E\\u662F\\u901A\\u8FC7 Proxy \\u4EE3\\u7406\\u5BF9\\u8C61\\u7684 get \\u64CD\\u4F5C\\uFF0C\\u76F8\\u5F53\\u4E8E \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"proxy.key\"), \" \\u6BCF\\u6B21\\u90FD\\u8FD9\\u6837\\u8BBF\\u95EE\\u6570\\u636E\\u624D\\u80FD\\u6210\\u529F\\u6536\\u96C6\\u5230\\u4F9D\\u8D56\\uFF0C\\u89E3\\u6784\\u7684\\u8BDD\\u662F \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"let key = proxy.key\"), \" \\u83B7\\u53D6\\u4E86 key \\u7684\\u503C\\uFF0C\\u4E4B\\u540E\\u901A\\u8FC7 key \\u8BBF\\u95EE\\u6570\\u636E\\u6CA1\\u6709\\u8FDB\\u5165\\u4EE3\\u7406\\u7684 get \\u64CD\\u4F5C\\uFF0C\\u6240\\u4EE5\\u4E0D\\u4F1A\\u6536\\u96C6\\u5230\\u4F9D\\u8D56\")), mdx(\"p\", null, \"\\u6700\\u540E\\u6211\\u4EEC\\u6765\\u770B\\u4E00\\u4E2A\\u4F8B\\u5B50\\uFF0C\\u8D70\\u4E00\\u904D\\u6574\\u4F53\\u7684\\u6D41\\u7A0B\\uFF0C\\u4EE5\\u4FBF\\u66F4\\u597D\\u7684\\u7406\\u89E3\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-html\"\n  }), \"<!DOCTYPE html>\\n<html lang=\\\"en\\\">\\n<head>\\n  <title>Counter</title>\\n</head>\\n<body>\\n  <div class=\\\"count\\\"></div>\\n  <button class=\\\"inc\\\">+</button>\\n  <button class=\\\"dec\\\">-</button>\\n<script type=\\\"module\\\">\\n  import { reactive, effect } from '../../packages/reactivity/index.js'\\n\\n  const $inc = document.querySelector('.inc')\\n  const $dec = document.querySelector('.dec')\\n  const $count = document.querySelector('.count')\\n\\n  const obj = { count: 0 }\\n  const state = reactive(obj)\\n\\n  effect(() => {\\n    $count.innerHTML = state.count\\n  })\\n\\n  $inc.addEventListener('click', () => {\\n    state.count++\\n  })\\n\\n  $dec.addEventListener('click', () => {\\n    state.count--\\n  })\\n</script>\\n</body>\\n</html>\\n\")), mdx(\"p\", null, \"\\u8FD9\\u91CC\\u9996\\u5148\\u7528 reactive \\u5B9A\\u4E49 state\\uFF0C\\u4F20\\u5165 effect\\uFF0C\\u7136\\u540E effect \\u4F1A\\u5148\\u6267\\u884C\\u4E00\\u904D\\uFF0C\\u5C06 activeEffect \\u8BBE\\u7F6E\\u4E3A\\u5B83\\uFF0C\\u7136\\u540E cleanup \\u4E00\\u904D\\uFF0C\\u56E0\\u4E3A\\u672C\\u6765\\u5C31\\u662F\\u7A7A\\u7684\\u6240\\u4EE5\\u4E5F\\u6CA1\\u4EC0\\u4E48\\u7528\\uFF0C\\u4E4B\\u540E\\u6267\\u884C\\u5230 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"$count.innerHTML = state.count\"), \" \\u89E6\\u53D1 state \\u7684 get \\u4EE3\\u7406\\uFF0Cget \\u4E2D\\u8C03\\u7528 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"track(obj, TrackOpTypes.GET, 'count')\"), \"\\uFF0C\\u5C06 activeEffect \\u6536\\u96C6\\u5230 dep\\uFF08\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"targetMap.set(obj, depsMap.set('count', activeEffect))\"), \"\\uFF09\\u4E2D\\uFF0C\\u6700\\u540E\\u8D4B\\u503C activeEffect \\u4E3A undefined\\uFF0C\\u5230\\u6B64 effect \\u9996\\u6B21\\u6267\\u884C\\u5B8C\\u6BD5\"), mdx(\"p\", null, \"\\u7136\\u540E\\u7ED1\\u5B9A\\u597D\\u4E8B\\u4EF6\\uFF0C\\u4E4B\\u540E\\u70B9\\u51FB\\u89E6\\u53D1\\u4E8B\\u4EF6\\u4F1A\\u89E6\\u53D1 state \\u7684 set \\u4EE3\\u7406\\uFF0C\\u8C03\\u7528 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"trigger(obj, TriggerOpTypes.SET, 'count')\"), \"\\uFF0C\\u4F9D\\u6B21\\u6267\\u884C\\u521A\\u521A\\u6536\\u96C6\\u597D\\u7684 effects\\uFF0C\\u89E6\\u53D1\\u4F9D\\u8D56\\uFF0C\\u4E5F\\u5C31\\u662F\\u6267\\u884C \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"effect(() => { $count.innerHTML = state.count) }\"), \"\\uFF0C\\u5176\\u4E2D effect \\u6267\\u884C\\u65F6\\u66F4\\u4E0A\\u9762\\u7B2C\\u4E00\\u6B21\\u6267\\u884C\\u4E00\\u6837\\uFF0C\\u8BBE\\u7F6E activeEffect \\u7136\\u540E cleanup \\u4E0A\\u4E00\\u6B21\\u7684\\u4F9D\\u8D56\\uFF0C\\u518D\\u8BBF\\u95EE \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"state.count\"), \" \\u89E6\\u53D1 get \\u4EE3\\u7406\\uFF0C\\u518D\\u628A activeEffect track \\u8D77\\u6765\\uFF0C\\u5B8C\\u6210\\u4F9D\\u8D56\\u6536\\u96C6\\uFF0C\\u6700\\u540E\\u91CD\\u65B0\\u8BBE\\u7F6E activeEffect\"), mdx(\"p\", null, \"\\u6240\\u4EE5\\u6D41\\u7A0B\\u57FA\\u672C\\u4E0A\\u662F\\u8FD9\\u6837\\u7684\\uFF1A(track effects) => (trigger effects, track effects) => (trigger effects, track effects) => ...\"), mdx(\"p\", null, \"\\u73B0\\u5728\\u5DF2\\u7ECF\\u8BB2\\u5B8C\\u4E86\\u54CD\\u5E94\\u5F0F\\u7684\\u6838\\u5FC3\\u539F\\u7406\\uFF0C\\u5269\\u4E0B\\u7684\\u6765\\u8BB2\\u4E00\\u4E0B collectionHandlers\\u3001ref\\u3001computed\"), mdx(\"h2\", {\n    \"id\": \"️-collectionhandlers\"\n  }, \"\\u2601\\uFE0F collectionHandlers\"), mdx(\"p\", null, \"\\u4E3A\\u4EC0\\u4E48 Map\\u3001Set\\u3001WeakMap\\u3001WeakSet \\u9700\\u8981\\u53E6\\u4E00\\u79CD handlers \\u6765\\u5904\\u7406\\u5462\\uFF1F\\u56E0\\u4E3A\\u8FD9\\u4E9B\\u7C7B\\u578B\\u7684 key \\u90FD\\u662F\\u56FA\\u5B9A\\u7684\\uFF0C\\u6BD4\\u5982\\u8C03\\u7528 map.set\\u3001map.get\\u3001map.has\\u3001map.delete \\u90FD\\u4F1A\\u89E6\\u53D1\\u4EE3\\u7406\\u7684 get \\u64CD\\u4F5C\\uFF0Cset\\u3001get\\u3001has\\u3001delete \\u8FD9\\u4E9B\\u5C31\\u662F\\u4ED6\\u4EEC key\\uFF0C\\u53EA\\u6709 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"map.get = ...\"), \" \\u624D\\u80FD\\u89E6\\u53D1\\u4EE3\\u7406\\u7684 set \\u64CD\\u4F5C\\uFF0C\\u6240\\u4EE5\\u5C31\\u9700\\u8981 collectionHandlers \\u4EE3\\u7406 get\\uFF0C\\u9488\\u5BF9\\u4E0D\\u540C\\u7684 key \\u8FDB\\u884C\\u4E0D\\u540C\\u7684\\u4EE3\\u7406\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/collectionHandlers.js\"\n  }), \"export const mutableCollectionHandlers = {\\n  get: createInstrumentationGetter(false),\\n}\\nexport const readonlyCollectionHandlers = {\\n  get: createInstrumentationGetter(true),\\n}\\n\")), mdx(\"p\", null, \"\\u540C\\u6837\\u7684\\u901A\\u8FC7 createInstrumentationGetter \\u4F20\\u5165 isReadonly \\u521B\\u5EFA\\u4E0D\\u540C\\u7684 handlers\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/collectionHandlers.js\"\n  }), \"function createInstrumentationGetter(isReadonly) {\\n  const instrumentations = createInstrumentation(isReadonly)\\n  \\n  return (target, key, receiver) => {\\n    if (key === ReactiveFlags.IS_REACTIVE) return !isReadonly\\n    if (key === ReactiveFlags.IS_READONLY) return isReadonly\\n    if (key === ReactiveFlags.RAW) return target\\n\\n    return Reflect.get(\\n      hasOwn(instrumentations, key) && key in target\\n        ? instrumentations\\n        : target,\\n      key,\\n      receiver,\\n    )\\n  }\\n}\\n\")), mdx(\"p\", null, \"\\u8FD9\\u91CC\\u521B\\u5EFA\\u771F\\u6B63\\u7684 instrumentations \\u6765\\u5904\\u7406 get \\u7684\\u4EE3\\u7406\\u64CD\\u4F5C\\uFF0C\\u6CE8\\u610F Reflect.get \\u7684\\u7B2C\\u4E09\\u4E2A\\u53C2\\u6570 receiver \\u6307 proxy \\u5B9E\\u4F8B\\uFF0C\\u7528\\u6765\\u6307\\u5B9A instrumentations \\u4E2D\\u7684 this\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/collectionHandlers.js\",\n    \"metastring\": \"{3}\",\n    \"{3}\": true\n  }), \"const createInstrumentation = (isReadonly) => ({\\n  get(key) {\\n    return get(this, key, isReadonly) // \\u901A\\u8FC7 Reflect \\u8C03\\u7528\\u65F6 this \\u662F receiver\\uFF08proxy \\u5B9E\\u4F8B\\uFF09\\n  },\\n  get size() {\\n    return size(this, isReadonly)\\n  },\\n  has(key) {\\n    return has(this, key, isReadonly)\\n  },\\n  add(value) {\\n    return add(this, value, isReadonly)\\n  },\\n  set(key, value) {\\n    return set(this, key, value, isReadonly)\\n  },\\n  delete(key) {\\n    return deleteEntry(this, key, isReadonly)\\n  },\\n  clear() {\\n    return clear(this, isReadonly)\\n  },\\n  forEach(callback, thisArg) {\\n    return forEach(this, callback, thisArg, isReadonly)\\n  },\\n  keys(...args) {\\n    return createIterableMethod('keys', isReadonly)(this, ...args)\\n  },\\n  values(...args) {\\n    return createIterableMethod('values', isReadonly)(this, ...args)\\n  },\\n  entries(...args) {\\n    return createIterableMethod('values', isReadonly)(this, ...args)\\n  },\\n  [Symbol.iterator](...args) {\\n    return createIterableMethod(Symbol.iterator, isReadonly)(this, ...args)\\n  },\\n})\\n\")), mdx(\"p\", null, \"\\u6211\\u4EEC\\u53EA\\u5B9E\\u73B0 get\\u3001set \\u548C iterator \\u8FD9\\u51E0\\u4E2A\\u65B9\\u6CD5\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/collectionHandlers.js\",\n    \"metastring\": \"{3,4,6}\",\n    \"{3,4,6}\": true\n  }), \"// Set, WeakSet, Map, WeakMap\\nconst get = (target, key, isReadonly) => {\\n  const rawTarget = toRaw(target)\\n  const rawKey = toRaw(key)\\n  !isReadonly && track(rawTarget, TrackOpTypes.GET, rawKey)\\n  const res = rawTarget.get(rawKey)\\n  if (isObject(res)) {\\n    return isReadonly ? readonly(res) : reactive(res)\\n  }\\n  return res\\n}\\n\")), mdx(\"p\", null, \"\\u9996\\u5148\\u770B get\\uFF0Ctarget \\u53C2\\u6570\\u5C31\\u662F\\u4F20\\u5165\\u7684 this\\uFF0C\\u5C31\\u662F Reflect.get \\u4F20\\u5165\\u7684 receiver\\uFF0C\\u4E5F\\u5C31\\u662F proxy \\u5B9E\\u4F8B\\uFF0C\\u5148\\u901A\\u8FC7 toRaw \\u5F97\\u5230\\u539F\\u5BF9\\u8C61\\u548C\\u539F key\\uFF0C\\u7531\\u4E8E\\u5BF9\\u8C61\\u548C\\u6570\\u7EC4\\u7684 key \\u90FD\\u662F\\u57FA\\u672C\\u7C7B\\u578B\\uFF0C\\u4E0D\\u4F1A\\u662F\\u54CD\\u5E94\\u5F0F\\u5BF9\\u8C61\\uFF0C\\u6240\\u4EE5\\u53EF\\u4EE5\\u76F4\\u63A5\\u901A\\u8FC7 key \\u6765 track\\uFF0C\\u800C collectionType \\u7684 key \\u53EF\\u80FD\\u662F\\u5F15\\u7528\\u7C7B\\u578B\\uFF0C\\u53EF\\u80FD\\u662F\\u54CD\\u5E94\\u5F0F\\u5BF9\\u8C61\\uFF0C\\u6240\\u4EE5\\u4E3A\\u4E86\\u4FDD\\u8BC1 track \\u548C trigger \\u7684 key \\u662F\\u540C\\u4E00\\u4E2A\\uFF0C\\u5C31\\u8981\\u90FD\\u7528\\u539F\\u5BF9\\u8C61\\u6216\\u54CD\\u5E94\\u5F0F\\u5BF9\\u8C61\\uFF0C\\u5982\\u679C\\u4F7F\\u7528\\u54CD\\u5E94\\u5F0F\\u5BF9\\u8C61\\u53C8\\u6709\\u7684\\u5BF9\\u8C61\\u5E76\\u4E0D\\u662F\\u54CD\\u5E94\\u5F0F\\u7684\\uFF0C\\u5728\\u8F6C\\u6210\\u54CD\\u5E94\\u5F0F\\u6D88\\u8017\\u4E86\\u5185\\u5B58\\uFF0C\\u6240\\u4EE5\\u90FD\\u901A\\u8FC7 rawTarget \\u548C rawKey \\u6765 track \\u548C trigger\"), mdx(\"p\", null, \"\\u540C\\u6837\\u7ED3\\u679C\\u5982\\u679C\\u662F\\u5BF9\\u8C61\\u9700\\u8981\\u8FD4\\u56DE\\u7ED3\\u679C\\u7684\\u54CD\\u5E94\\u5F0F\\u7248\\u672C\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/collectionHandlers.js\",\n    \"metastring\": \"{4-8}\",\n    \"{4-8}\": true\n  }), \"// Map, WeakMap\\nconst set = (target, key, value, isReadonly) => {\\n  if (isReadonly) throw new Error(`operation SET failed: target is readonly.`)\\n  const rawTarget = toRaw(target)\\n  const rawKey = toRaw(key)\\n  const rawValue = toRaw(value)\\n  const hadKey = rawTarget.has(rawKey)\\n  const res = rawTarget.set(rawKey, rawValue)\\n  if (hadKey) {\\n    trigger(rawTarget, TriggerOpTypes.ADD, rawKey)\\n  } else {\\n    trigger(rawTarget, TriggerOpTypes.SET, rawKey)\\n  }\\n  return res\\n}\\n\")), mdx(\"p\", null, \"set \\u662F\\u53EA\\u6709 Map \\u548C WeakMap \\u6709\\u7684\\uFF0CSet\\u3001WeakSet \\u5BF9\\u5E94\\u7684\\u662F add\\uFF0C\\u8FD9\\u4E24\\u4E2A\\u5B9E\\u73B0\\u7C7B\\u4F3C\\uFF0C\\u4E5F\\u662F\\u5148\\u627E\\u5230 rawTarget \\u548C rawKey\\uFF0C\\u7136\\u540E\\u5728 trigger \\u4E4B\\u524D\\u6C42\\u51FA\\u7ED3\\u679C\\uFF0C\\u5E76\\u5224\\u65AD\\u539F\\u6765\\u662F\\u5426\\u6709 rawKey\\uFF0C\\u8FDB\\u884C\\u5BF9\\u5E94\\u7684 trigger\\uFF0C\\u5982\\u679C\\u539F\\u6765\\u6CA1\\u6709\\u5C31\\u662F\\u65B0\\u589E\\u4E86 key\\uFF0C\\u5BF9\\u4F9D\\u8D56\\u4E8E iterator \\u64CD\\u4F5C\\u7684 effect \\u4F1A\\u6709\\u5F71\\u54CD\\uFF0C\\u6240\\u4EE5\\u9700\\u8981\\u533A\\u5206\\u6765\\u5904\\u7406\"), mdx(\"blockquote\", null, mdx(\"ol\", {\n    parentName: \"blockquote\"\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u6E90\\u7801\\u4E2D\\u4F1A\\u5224\\u65AD key !== rawKey\\uFF0C\\u5982\\u679C\\u662F true \\u5C31\\u518D track \\u4E00\\u904D key\\uFF0C\\u5177\\u4F53\\u53EF\\u4EE5\\u770B \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/vuejs/vue-next/issues/919\"\n  }), \"Issues: Effect don't work when use reactive to proxy a Map which has reactive object as member's key.\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u6E90\\u7801\\u4E2D\\u4E5F\\u5BF9 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"readonly(reactive(obj))\"), \" \\u8FDB\\u884C\\u4E86\\u5904\\u7406\\uFF0C\\u5148\\u901A\\u8FC7 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"target = (target as any)[ReactiveFlags.RAW]\"), \" \\u62FF\\u5230 reactive \\u5BF9\\u8C61\\uFF0C\\u7136\\u540E\\u901A\\u8FC7 toRaw \\u4EE5\\u4FDD\\u8BC1\\u62FF\\u5230 rawTarget\\uFF0C\\u540E\\u9762\\u518D\\u901A\\u8FC7 target.get \\u53D6\\u503C\\uFF0C\\u8FDB\\u884C\\u76F8\\u5E94\\u7684 track\")))), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/collectionHandlers.js\",\n    \"metastring\": \"{4,10-25}\",\n    \"{4,10-25}\": true\n  }), \"const createIterableMethod = (method, isReadonly) => {\\n  return (target, ...args) => {\\n    const rawTarget = toRaw(target)\\n    const rawIterator = rawTarget[method](...args)\\n    const wrap = (value) => {\\n      if (isObject(value)) return isReadonly ? readonly(value) : reactive(value)\\n      return value\\n    }\\n    !isReadonly && track(rawTarget, TrackOpTypes.ITERATE, ITERATE_KEY)\\n    return {\\n      // iterator protocol\\n      next() {\\n        const { value, done } = rawIterator.next()\\n        return done\\n          ? { value, done }\\n          : {\\n            value: method === 'entries' ? [wrap(value[0]), wrap(value[1])] : wrap(value),\\n            done,\\n          }\\n      },\\n      // iterable protocol\\n      [Symbol.iterator]() {\\n        return this // \\u8FD4\\u56DE\\u62E6\\u622A\\u7684 Iterator\\uFF1ArawIterator -> proxyIterator(this)\\n      },\\n    }\\n  }\\n}\\n\")), mdx(\"p\", null, \"\\u4E5F\\u6BD4\\u8F83\\u597D\\u7406\\u89E3\\uFF0C\\u5C31\\u662F\\u7C7B\\u4F3C\\u4E0A\\u9762\\u7684\\u81EA\\u5DF1\\u5B9E\\u73B0\\u4E86 iterator \\u63A5\\u53E3\\uFF0C\\u9700\\u8981\\u6CE8\\u610F \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"[Symbol.iterator]\"), \" \\u65B9\\u6CD5\\u8FD4\\u56DE\\u7684 this \\u5C31\\u662F\\u8FD9\\u4E2A\\u5BF9\\u8C61\\uFF0C\\u6307\\u6211\\u4EEC\\u5B9E\\u73B0\\u7684 proxyIterator \\u800C\\u4E0D\\u662F rawIterator\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u6E90\\u7801\\u4E2D\\u5BF9\\u4E8E \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MAP_KEY_ITERATE_KEY\"), \" \\u7684\\u5904\\u7406\\u53EF\\u4EE5\\u770B\\u770B\\u8FD9\\u4E2A \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/vuejs/vue-next/commit/45ba06ac5f49876b4f05e5996f595b2c4a761f47\"\n  }), \"commit\"), \"\\uFF0Cmap \\u5728 set \\u4E00\\u4E2A\\u5DF2\\u6709\\u7684 key \\u65F6\\u4E0D\\u80FD\\u89E6\\u53D1 key \\u7684 iterator \\u76F8\\u5173 effect\")), mdx(\"h2\", {\n    \"id\": \"-ref\"\n  }, \"\\uD83D\\uDCAB ref\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"export const ref = (value) => reactive({ value }) // \\u7B80\\u6613 ref\\n\")), mdx(\"p\", null, \"\\u5728\\u73B0\\u5728\\u7684\\u57FA\\u7840\\u4E0A\\u5B9E\\u73B0\\u6CA1\\u6709\\u4F18\\u5316\\u7684 ref \\u548C computed \\u5C31\\u5F88\\u7B80\\u5355\\u4E86\\uFF0C\\u4F46\\u662F Vue \\u5BF9\\u4ED6\\u4EEC\\u7684\\u4F18\\u5316\\u8FD8\\u662F\\u5F88\\u503C\\u5F97\\u5B66\\u4E60\\u7684\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/ref.js\",\n    \"metastring\": \"{3,4}\",\n    \"{3,4}\": true\n  }), \"export function customRef(factory) {\\n  const { get, set } = factory(\\n    () => track(ref, TrackOpTypes.GET, 'value'),\\n    () => trigger(ref, TriggerOpTypes.SET, 'value'),\\n  )\\n  const ref = {\\n    __v_isRef: true,\\n    get value() {\\n      return get()\\n    },\\n    set value(v) {\\n      set(v)\\n    },\\n  }\\n  return ref\\n}\\n\")), mdx(\"p\", null, \"\\u6211\\u4EEC\\u5148\\u5B9E\\u73B0 customRef\\uFF0C\\u4ED6\\u7684\\u53C2\\u6570\\u662F\\u4E00\\u4E2A\\u63A5\\u6536\\u5C01\\u88C5\\u597D\\u7684 track \\u548C trigger \\u51FD\\u6570\\u7684\\u51FD\\u6570\\uFF0C\\u7528\\u6765\\u751F\\u6210 ref \\u7684 get value \\u65B9\\u6CD5\\u548C set value \\u65B9\\u6CD5\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/ref.js\",\n    \"metastring\": \"{8}\",\n    \"{8}\": true\n  }), \"export function ref(value) {\\n  return customRef((track, trigger) => ({\\n    get: () => {\\n      track()\\n      return value\\n    },\\n    set: (newValue) => {\\n      value = newValue\\n      trigger()\\n    },\\n  }))\\n}\\n\")), mdx(\"p\", null, \"\\u63A5\\u7740 ref \\u5B9E\\u73B0\\u5C31\\u7B80\\u5355\\u4E86\\uFF0C\\u5C31\\u662F\\u5728 get \\u65F6 track\\uFF0Cset \\u65F6 trigger\\uFF0C\\u800C value \\u7684\\u503C\\u901A\\u8FC7\\u521B\\u5EFA\\u7684\\u95ED\\u5305\\u4FDD\\u5B58\"), mdx(\"h2\", {\n    \"id\": \"️-computed\"\n  }, \"\\u2604\\uFE0F computed\"), mdx(\"p\", null, \"\\u6700\\u540E\\u770B\\u4E00\\u4E0B computed \\u7684\\u5B9E\\u73B0\\uFF0C\\u5176\\u5B9E computed \\u4E5F\\u662F\\u4E00\\u4E2A customRef\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/computed.js\"\n  }), \"export function computed(options) {\\n  let getter\\n  let setter\\n  if (isFunction(options)) {\\n    getter = options\\n    setter = () => {\\n      console.warn('Write operation failed: computed value is readonly')\\n    }\\n  } else {\\n    getter = options.get\\n    setter = options.set\\n  }\\n\\n  return createComputedRef(getter, setter)\\n}\\n\")), mdx(\"p\", null, \"\\u9996\\u5148\\u5728\\u5165\\u53E3\\u5224\\u65AD\\u662F\\u5426\\u4F20\\u5165\\u4E86 setter\\uFF0C\\u5982\\u679C\\u6CA1\\u6709\\u5C31\\u76F8\\u5F53\\u4E8E\\u89E6\\u53D1 set \\u7684\\u65F6\\u5019\\u53EA\\u62A5\\u4E00\\u4E2A\\u8B66\\u544A\\uFF0C\\u901A\\u8FC7 createComputedRef \\u521B\\u5EFA\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js:title=reactivity/computed.js\",\n    \"metastring\": \"{3,6-12,16-21}\",\n    \"{3,6-12,16-21}\": true\n  }), \"function createComputedRef(getter, setter) {\\n  let dirty = true\\n  let value // \\u901A\\u8FC7\\u95ED\\u5305\\u5B58\\n  const computedRef = customRef((track, trigger) => {\\n    const computeEffect = effect(getter, {\\n      lazy: true,\\n      scheduler() {\\n        if (!dirty) {\\n          dirty = true\\n          trigger()\\n        }\\n      },\\n    })\\n    return {\\n      get: () => {\\n        if (dirty) {\\n          value = computeEffect()\\n          dirty = false\\n        }\\n        track()\\n        return value\\n      },\\n      set: (newValue) => {\\n        setter(newValue)\\n      },\\n    }\\n  })\\n  return computedRef\\n}\\n\")), mdx(\"p\", null, \"\\u9996\\u5148 dirty \\u4E00\\u5F00\\u59CB\\u662F true\\uFF0C\\u521B\\u5EFA computedRef \\u65F6\\u5148\\u521B\\u5EFA computeEffect\\uFF0C\\u4F20\\u5165\\u7684\\u51FD\\u6570\\u5C31\\u662F\\u6211\\u4EEC\\u7684 getter\\uFF0CVue \\u5BF9\\u4E8E computed \\u7684\\u4F18\\u5316\\u5C31\\u5728\\u4E8E\\u5728\\u9700\\u8981\\u5B83\\u7684\\u503C\\u65F6\\u624D\\u53BB\\u8BA1\\u7B97\\u5B83\\u7684\\u503C\\uFF0C\\u6BCF\\u6B21\\u90FD\\u4F1A\\u8BA1\\u7B97\\u51FA\\u6700\\u65B0\\u7684\\uFF0C\\u7701\\u7565\\u4E86\\u4E00\\u4E9B\\u6CA1\\u7528\\u7684\\u503C\\u7684\\u8BA1\\u7B97\\uFF0C\\u6BD4\\u5982\\u8BF4\\u6211\\u6539\\u53D8\\u4E86\\u4E09\\u6B21 computed \\u4F9D\\u8D56\\u7684\\u503C\\uFF0C\\u4F46\\u6E32\\u67D3\\u65F6\\u53EA\\u9700\\u8981\\u5B83\\u6700\\u65B0\\u7684\\u7B2C\\u4E09\\u6B21\\u7684\\u503C\\uFF0C\\u90A3\\u4E48\\u524D\\u4E24\\u6B21\\u5C31\\u4E0D\\u4F1A\\u53BB\\u8BA1\\u7B97\\u3002\\u4E3A\\u4E86\\u5B9E\\u73B0\\u8FD9\\u4E2A\\u6211\\u4EEC\\u7684 computeEffect \\u5C31\\u9700\\u8981\\u8BBE\\u7F6E\\u6210 lazy \\u7684\\uFF0C\\u9996\\u6B21\\u4E0D\\u9700\\u8981\\u6267\\u884C computeEffect\\uFF0C\\u540C\\u65F6 dirty \\u662F true\\uFF0C\\u771F\\u6B63\\u7B2C\\u4E00\\u6B21 get computedRef \\u65F6\\u624D\\u4F1A\\u624B\\u52A8\\u89E6\\u53D1 computeEffect\\uFF0C\\u8FD0\\u884C getter \\u51FD\\u6570\\uFF0C\\u5BF9 getter \\u51FD\\u6570\\u4E2D\\u7684\\u4F9D\\u8D56\\u8FDB\\u884C track\\uFF0C\\u7136\\u540E\\u8FD4\\u56DE\\u7ED3\\u679C\\u8D4B\\u503C\\u7ED9 value\\uFF0C\\u8FD9\\u91CC effect \\u51FD\\u6570\\u4E0D\\u8FD4\\u56DE stop \\u51FD\\u6570\\u800C\\u662F\\u8FD4\\u56DE\\u7ED3\\u679C\\u7684\\u4F5C\\u7528\\u5C31\\u4F53\\u73B0\\u51FA\\u6765\\u4E86\\uFF0C\\u4E4B\\u540E\\u56DE\\u5230 get \\u65B9\\u6CD5\\u4E2D\\u7EE7\\u7EED track computedRef.value \\u7684\\u4F9D\\u8D56\\uFF0C\\u8FD9\\u6837\\u4E0B\\u6B21 getter \\u4E2D\\u4F9D\\u8D56\\u7684\\u54CD\\u5E94\\u5F0F\\u5BF9\\u8C61\\u89E6\\u53D1 set \\u4EE3\\u7406\\u5C31\\u4F1A trigger\\uFF0C\\u8FDB\\u5165\\u5230 scheduler \\u4E2D\\uFF0C\\u5728 scheduler \\u4E2D\\u518D trigger \\u4F9D\\u8D56\\u4E8E computedRef \\u7684\\u4F9D\\u8D56\\uFF0C\\u4EE5\\u6B64\\u5B9E\\u73B0 computed\"), mdx(\"p\", null, \"\\u5927\\u81F4\\u6D41\\u7A0B\\u5C31\\u662F\\uFF1A\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"(first get computed, call computeEffect, track getter dep, set new value, track computed value, return value) =>\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"(second get computed, dirty is false, return value) =>\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"(set getter dep, trigger getter dep, scheduler, trigger computed value) =>\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"(third get computed, call computeEffect, track getter dep, set new value, track computed value, return value) => ...\"))), mdx(\"h2\", {\n    \"id\": \"-ramble\"\n  }, \"\\uD83D\\uDE03 ramble\"), mdx(\"p\", null, \"\\u524D\\u51E0\\u5929\\u5728\\u77E5\\u4E4E\\u4E0A\\u63D0\\u4E86\\u4E00\\u4E2A\\u95EE\\u9898\\uFF1A\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.zhihu.com/question/416652570\"\n  }), \"Vue3 composition-api \\u6709\\u54EA\\u4E9B\\u52A3\\u52BF\\uFF1F\"), \"\\uFF0C\\u56E0\\u4E3A\\u662F\\u5F88\\u4E45\\u4E4B\\u524D\\u770B\\u7684 RFC\\uFF0C\\u5FD8\\u8BB0\\u4E86 RFC \\u4E2D\\u6709\\u63D0\\u5230\\u52A3\\u52BF\\u7684\\u5185\\u5BB9\\uFF0C\\u4F46\\u662F\\u770B\\u56DE\\u7B54\\u57FA\\u672C\\u4E0A\\u4E5F\\u90FD\\u662F RFC \\u4E2D\\u63D0\\u5230\\u8FC7\\u7684\"), mdx(\"p\", null, \"\\u9996\\u5148\\u662F ref \\u7684\\u5FC3\\u667A\\u8D1F\\u62C5\\uFF0C\\u5728\\u8BFB\\u6E90\\u7801\\u65F6\\u53EF\\u4EE5\\u4ECE reactive \\u5BF9\\u8C61 get \\u53D6\\u51FA\\u6765\\u5982\\u679C\\u662F ref \\u4F1A\\u81EA\\u52A8\\u8FD4\\u56DE value \\u53EF\\u4EE5\\u770B\\u51FA Vue \\u662F\\u60F3\\u5C06 ref \\u5F53\\u4F5C\\u4E00\\u79CD\\u65B0\\u7684\\u57FA\\u672C\\u7C7B\\u578B\\uFF0C\\u5BF9\\u5E94 reactive \\u54CD\\u5E94\\u5F0F\\u7684\\u5F15\\u7528\\u7C7B\\u578B\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"let count = ref(0)\\ncount++\\nconsole.log(count) // 1\\n\")), mdx(\"p\", null, \"\\u4F46\\u662F\\u7531\\u4E8E JavaScript \\u7684\\u4E0D\\u8DB3\\u800C\\u6CA1\\u6709\\u5B9E\\u73B0\\uFF0C\\u6211\\u4E5F\\u5C1D\\u8BD5\\u5199\\u4E86 babel macro \\u53BB\\u5F25\\u8865\\u8FD9\\u79CD\\u4E0D\\u8DB3\\uFF0C\\u4F46\\u7531\\u4E8E\\u96BE\\u4EE5\\u7ED3\\u5408\\u751F\\u6001\\u5C31\\u6CA1\\u6709\\u5199\\u5B8C\\uFF0C\\u800C\\u4E14\\u5982\\u679C\\u4F7F\\u7528 TypeScript \\u901A\\u8FC7\\u7C7B\\u578B\\u63D0\\u793A\\u57FA\\u672C\\u6CA1\\u6709\\u4EC0\\u4E48\\u8D1F\\u62C5\"), mdx(\"p\", null, \"\\u7136\\u540E\\u662F\\u4E0D\\u80FD\\u89E3\\u6784\\uFF0C\\u56E0\\u4E3A setup \\u53EA\\u4F1A\\u8FD0\\u884C\\u4E00\\u6B21\\uFF0C\\u901A\\u8FC7 proxy.key \\u624D\\u80FD\\u6210\\u529F track \\u6216 trigger\\uFF0C\\u5982\\u679C\\u5C06\\u89E3\\u6784\\u8D4B\\u503C\\uFF08\\u53D6\\u503C\\uFF09\\u5199\\u5230 render function \\u4E2D\\uFF0C\\u6BCF\\u6B21\\u6E32\\u67D3\\u90FD\\u4F1A\\u91CD\\u65B0\\u53D6\\u503C\\uFF0C\\u5C31\\u80FD\\u4F7F\\u7528\\u89E3\\u6784\\uFF0C\\u4F46\\u8FD9\\u6837\\u4EE3\\u7801\\u53CD\\u800C\\u66F4\\u4E71\"), mdx(\"p\", null, \"\\u6700\\u540E\\u662F\\u66F4\\u591A\\u7684\\u7075\\u6D3B\\u6027\\u6765\\u81EA\\u66F4\\u591A\\u7684\\u81EA\\u6211\\u514B\\u5236\\uFF0C\\u6211\\u5F88\\u540C\\u610F\\u8FD9\\u53E5\\u8BDD\\uFF1A\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"\\u7F16\\u5199\\u6709\\u7EC4\\u7EC7\\u7684 JavaScript \\u4EE3\\u7801\\u7684\\u6280\\u80FD\\u76F4\\u63A5\\u8F6C\\u5316\\u4E3A\\u4E86\\u7F16\\u5199\\u6709\\u7EC4\\u7EC7\\u7684 Vue \\u4EE3\\u7801\\u7684\\u6280\\u80FD\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/ahabhgk/simple-vue3/tree/master/packages/reactivity\"\n  }), \"simple-vue/reactivity \\u5B9E\\u73B0\\u5B8C\\u6574\\u4EE3\\u7801\"))));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Table of Contents 序 首先一起实现一个简易的 reactivity 吧，穿插着会提到源码中的一些细节，建议先跟着写写，细节可以 clone 下来 vue-next 打开源码跟着看 ⭐️ reactive 首先是  reactive…","timeToRead":4,"banner":null}},"pageContext":{"slug":"/blog/vue-reactivity-in-depth","formatString":"DD.MM.YYYY"}},"staticQueryHashes":["318001574","3787687951","3787687951"]}