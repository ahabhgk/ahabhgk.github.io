{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-page-query-tsx","path":"/note/javascript-design-patterns-and-development-practices/shared","result":{"data":{"page":{"__typename":"MdxPage","title":"享元模式","slug":"/note/javascript-design-patterns-and-development-practices/shared","excerpt":"享元（flyweight）模式是一种用于性能优化的模式，“fly…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"享元模式\",\n  \"slug\": \"/note/javascript-design-patterns-and-development-practices/shared\",\n  \"date\": \"2019-07-10T00:00:00.000Z\",\n  \"description\": \"《JavaScript 设计模式与开发实践》读书笔记\",\n  \"tags\": [\"Note\", \"JavaScript Design Patterns and Development Practices\"]\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"\\u4EAB\\u5143\\uFF08flyweight\\uFF09\\u6A21\\u5F0F\\u662F\\u4E00\\u79CD\\u7528\\u4E8E\\u6027\\u80FD\\u4F18\\u5316\\u7684\\u6A21\\u5F0F\\uFF0C\\u201Cfly\\u201D\\u5728\\u8FD9\\u91CC\\u662F\\u82CD\\u8747\\u7684\\u610F\\u601D\\uFF0C\\u610F\\u4E3A\\u8747\\u91CF\\u7EA7\\u3002\\u4EAB\\u5143\\u6A21\\u5F0F\\u7684\\u6838\\u5FC3\\u662F\\u8FD0\\u7528\\u5171\\u4EAB\\u6280\\u672F\\u6765\\u6709\\u6548\\u652F\\u6301\\u5927\\u91CF\\u7EC6\\u7C92\\u5EA6\\u7684\\u5BF9\\u8C61\\u3002\"), mdx(\"p\", null, \"\\u4EAB\\u5143\\u6A21\\u5F0F\\u8981\\u6C42\\u5C06\\u5BF9\\u8C61\\u7684\\u5C5E\\u6027\\u5212\\u5206\\u4E3A\\u5185\\u90E8\\u72B6\\u6001\\u4E0E\\u5916\\u90E8\\u72B6\\u6001\\uFF08\\u72B6\\u6001\\u5728\\u8FD9\\u91CC\\u901A\\u5E38\\u6307\\u5C5E\\u6027\\uFF09\\u3002\\u4EAB\\u5143\\u6A21\\u5F0F\\u7684\\u76EE\\u6807\\u662F\\u5C3D\\u91CF\\u51CF\\u5C11\\u5171\\u4EAB\\u5BF9\\u8C61\\u7684\\u6570\\u91CF\\uFF0C\\u5173\\u4E8E\\u5982\\u4F55\\u5212\\u5206\\u5185\\u90E8\\u72B6\\u6001\\u548C\\u5916\\u90E8\\u72B6\\u6001\\uFF0C\\u4E0B\\u9762\\u7684\\u51E0\\u6761\\u7ECF\\u9A8C\\u63D0\\u4F9B\\u4E86\\u4E00\\u4E9B\\u6307\\u5F15\\uFF1A\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u5185\\u90E8\\u72B6\\u6001\\u5B58\\u50A8\\u4E8E\\u5BF9\\u8C61\\u5185\\u90E8\\u3002\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u5185\\u90E8\\u72B6\\u6001\\u53EF\\u4EE5\\u88AB\\u4E00\\u4E9B\\u5BF9\\u8C61\\u5171\\u4EAB\\u3002\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u5185\\u90E8\\u72B6\\u6001\\u72EC\\u7ACB\\u4E8E\\u5177\\u4F53\\u7684\\u573A\\u666F\\uFF0C\\u901A\\u5E38\\u4E0D\\u4F1A\\u6539\\u53D8\\u3002\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u5916\\u90E8\\u72B6\\u6001\\u53D6\\u51B3\\u4E8E\\u5177\\u4F53\\u7684\\u573A\\u666F\\uFF0C\\u5E76\\u6839\\u636E\\u573A\\u666F\\u800C\\u53D8\\u5316\\uFF0C\\u5916\\u90E8\\u72B6\\u6001\\u4E0D\\u80FD\\u88AB\\u5171\\u4EAB\\u3002\"))), mdx(\"p\", null, \"\\u8FD9\\u6837\\u4E00\\u6765\\uFF0C\\u6211\\u4EEC\\u4FBF\\u53EF\\u4EE5\\u628A\\u6240\\u6709\\u5185\\u90E8\\u72B6\\u6001\\u76F8\\u540C\\u7684\\u5BF9\\u8C61\\u90FD\\u6307\\u5B9A\\u4E3A\\u540C\\u4E00\\u4E2A\\u5171\\u4EAB\\u7684\\u5BF9\\u8C61\\u3002\\u800C\\u5916\\u90E8\\u72B6\\u6001\\u53EF\\u4EE5\\u4ECE\\u5BF9\\u8C61\\u8EAB\\u4E0A\\u5265\\u79BB\\u51FA\\u6765\\uFF0C\\u5E76\\u50A8\\u5B58\\u5728\\u5916\\u90E8\\u3002\"), mdx(\"p\", null, \"\\u5265\\u79BB\\u4E86\\u5916\\u90E8\\u72B6\\u6001\\u7684\\u5BF9\\u8C61\\u6210\\u4E3A\\u5171\\u4EAB\\u5BF9\\u8C61\\uFF0C\\u5916\\u90E8\\u72B6\\u6001\\u5728\\u5FC5\\u8981\\u65F6\\u88AB\\u4F20\\u5165\\u5171\\u4EAB\\u5BF9\\u8C61\\u6765\\u7EC4\\u88C5\\u6210\\u4E00\\u4E2A\\u5B8C\\u6574\\u7684\\u5BF9\\u8C61\\u3002\\u867D\\u7136\\u7EC4\\u88C5\\u5916\\u90E8\\u72B6\\u6001\\u6210\\u4E3A\\u4E00\\u4E2A\\u5B8C\\u6574\\u5BF9\\u8C61\\u7684\\u8FC7\\u7A0B\\u9700\\u8981\\u82B1\\u8D39\\u4E00\\u5B9A\\u7684\\u65F6\\u95F4\\uFF0C\\u4F46\\u5374\\u53EF\\u4EE5\\u5927\\u5927\\u51CF\\u5C11\\u7CFB\\u7EDF\\u4E2D\\u7684\\u5BF9\\u8C61\\u6570\\u91CF\\uFF0C\\u76F8\\u6BD4\\u4E4B\\u4E0B\\uFF0C\\u8FD9\\u70B9\\u65F6\\u95F4\\u6216\\u8BB8\\u662F\\u5FAE\\u4E0D\\u8DB3\\u9053\\u7684\\u3002\\u56E0\\u6B64\\uFF0C\\u4EAB\\u5143\\u6A21\\u5F0F\\u662F\\u4E00\\u79CD\\u7528\\u65F6\\u95F4\\u6362\\u7A7A\\u95F4\\u7684\\u4F18\\u5316\\u6A21\\u5F0F\\u3002\"), mdx(\"h2\", {\n    \"id\": \"文件上传\"\n  }, \"\\u6587\\u4EF6\\u4E0A\\u4F20\"), mdx(\"p\", null, \"\\u4E24\\u79CD\\u4E0A\\u4F20\\u7C7B\\u578B\\uFF1Aplugin\\u3001flash\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"class Upload {\\n  constructor(uploadType, fileName, fileSize) {\\n    this.uploadType = uploadType\\n    this.fileName = fileName\\n    this.fileSize = fileSize\\n    this.dom = null\\n  }\\n\\n  init(id) {\\n    this.id = id\\n    this.dom = document.createElement('div')\\n    this.dom.innerHTML = `\\n      <span>\\u6587\\u4EF6\\u540D\\u79F0\\uFF1A${this.fileName}, \\u6587\\u4EF6\\u5927\\u5C0F\\uFF1A${this.fileSize}</span>\\n      <button class=\\\"delFile\\\">\\u5220\\u9664</button>\\n    `\\n    this.dom.querySelector('.delFile').onclick = () => {\\n      this.delFile()\\n    }\\n    document.body.appendChild(this.dom)\\n  }\\n\\n  delFile() {\\n    this.dom.parentNode.removeChild(this.dom)\\n  }\\n}\\n\\nlet id = 0\\n\\nwindow.startUpload = function (uploadType, files) {\\n  files.foeEach(file => {\\n    const uploadObj = new Upload(uploadType, file.fileName, file.fileSize)\\n    uploadObj.init(id++)\\n  })\\n}\\n\\nstartUpload('plugin', [\\n  {\\n    fileName: 'one.txt',\\n    fileSize: 1000,\\n  },\\n  {\\n    fileName: 'two.txt',\\n    fileSize: 3000,\\n  },\\n])\\n\\nstartUpload('flash', [\\n  {\\n    fileName: 'three.png',\\n    fileSize: '5000',\\n  },\\n  {\\n    fileName: 'four.png',\\n    fileSize: 4000,\\n  },\\n])\\n\")), mdx(\"p\", null, \"\\u53EF\\u89C1\\u6BCF\\u4E2A\\u6587\\u4EF6\\u90FD\\u8981\\u6709\\u4E00\\u4E2A Upload \\u5BF9\\u8C61\\uFF0C\\u5F53\\u4E0A\\u4F20\\u7684\\u6587\\u4EF6\\u6781\\u591A\\u65F6\\uFF0C\\u4F1A\\u5F00\\u9500\\u6781\\u5927\\u751A\\u81F3\\u9020\\u6210\\u5185\\u5B58\\u4E0D\\u8DB3\"), mdx(\"p\", null, \"\\u53EF\\u4EE5\\u7528\\u4EAB\\u5143\\u6A21\\u5F0F\\u4F18\\u5316\\uFF1A\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"class Upload {\\n  constructor(uploadType) {\\n    this.uploadType = uploadType\\n  }\\n\\n  delFile(id) {\\n    uploadManager.setExternalState(id, this)\\n    this.dom.parentNode.removeChild(this.dom)\\n  }\\n}\\n\\nconst UploadFactory = (function () {\\n  const createdFlyWeightObjs = {}\\n  return {\\n    create(uploadType) {\\n      if (createdFlyWeightObjs[uploadType]) {\\n        return createdFlyWeightObjs[uploadType]\\n      }\\n      return createdFlyWeightObjs[uploadType] = new Upload(uploadType)\\n    }\\n  }\\n})()\\n\\nconst uploadManager = (function () {\\n  const uploadDatabase = {}\\n\\n  return {\\n    add(id, uploadType, fileName, fileSize) {\\n      const flyWeightObj = UploadFactory.create(uploadType)\\n      const dom = document.createElement('div')\\n\\n      dom.innerHTML = `\\n        <span>\\u6587\\u4EF6\\u540D\\u79F0\\uFF1A${fileName}, \\u6587\\u4EF6\\u5927\\u5C0F\\uFF1A${fileSize}</span>\\n        <button class=\\\"delFile\\\">\\u5220\\u9664</button>\\n      `\\n      dom.querySelector('.delFile').onclick = () => {\\n        flyWeightObj.delFile(id)\\n      }\\n      document.body.appendChild(this.dom)\\n\\n      uploadDatabase[id] = {\\n        fileName,\\n        fileSize,\\n        dom,\\n      }\\n\\n      return flyWeightObj\\n    },\\n\\n    setExternalState(id, flyWeightObj) {\\n      const uploadData = uploadDatabase[id]\\n      for (const i in uploadData){\\n        flyWeightObj[i] = uploadData[i]\\n      }\\n    },\\n  }\\n})()\\n\\nlet id = 0\\n\\nwindow.startUpload = function (uploadType, files) {\\n  files.forEach(file => {\\n    uploadManager.add(id++, uploadType, file.fileName, file.fileSize)\\n  })\\n}\\n\\n// \\u4F7F\\u7528\\u540C\\u4E0A\\n\")), mdx(\"p\", null, \"\\u4EAB\\u5143\\u6A21\\u5F0F\\u91CD\\u6784\\u4E4B\\u524D\\u7684\\u4EE3\\u7801\\u91CC\\u4E00\\u5171\\u521B\\u5EFA\\u4E86 6 \\u4E2A upload \\u5BF9\\u8C61\\uFF0C\\u800C\\u901A\\u8FC7\\u4EAB\\u5143\\u6A21\\u5F0F\\u91CD\\u6784\\u4E4B\\u540E\\uFF0C\\u5BF9\\u8C61\\u7684\\u6570\\u91CF\\u51CF\\u5C11\\u4E3A 2\\uFF0C\\u66F4\\u5E78\\u8FD0\\u7684\\u662F\\uFF0C\\u5C31\\u7B97\\u73B0\\u5728\\u540C\\u65F6\\u4E0A\\u4F20 2000 \\u4E2A\\u6587\\u4EF6\\uFF0C\\u9700\\u8981\\u521B\\u5EFA\\u7684 upload \\u5BF9\\u8C61\\u6570\\u91CF\\u4F9D\\u7136\\u662F 2\"), mdx(\"p\", null, \"\\u5F88\\u5BB9\\u6613\\u8BA9\\u4EBA\\u8054\\u60F3\\u5230 JavaScript \\u7684\\u539F\\u578B\\uFF1A\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const PluginUploader = function (fileName, fileSize) {\\n  this.fileName = fileName\\n}\\nPluginUploader.prototype.uploadType = 'plugin' // \\u4EAB\\u5143\\nPluginUploader.prototype.add = function () {\\n  // ...\\n}\\n\\nconst FlashUploader = function (fileName, fileSize) {\\n  this.fileName, fileSize\\n}\\nFlashUploader.prototype.uploadType = 'flash' // \\u4EAB\\u5143\\nFlashUploader.prototype.add = function () {\\n  // ...\\n}\\n\")), mdx(\"p\", null, \"\\u4E4B\\u524D\\u867D\\u7136\\u53EA\\u6709\\u4E24\\u4E2A upload \\u5BF9\\u8C61\\uFF08\\u5185\\u90E8\\u72B6\\u6001\\uFF09\\uFF0C\\u4F46\\u5BF9\\u6587\\u4EF6\\u7684\\u63CF\\u8FF0\\u5BF9\\u8C61\\uFF08\\u5916\\u90E8\\u72B6\\u6001\\uFF09\\u4ECD\\u7136\\u4E0D\\u4F1A\\u51CF\\u5C11\\uFF0C\\u8FD9\\u91CC\\u7684 prototype \\u7528\\u4E8E\\u505A\\u5185\\u90E8\\u72B6\\u6001\\uFF0C\\u4E00\\u5171\\u4E5F\\u662F\\u4E24\\u4E2A\\uFF0C\\u6784\\u9020\\u51FD\\u6570\\u901A\\u8FC7\\u4F20\\u53C2\\u6784\\u9020\\u51FA\\u5916\\u90E8\\u72B6\\u6001\"), mdx(\"p\", null, \"\\u7531\\u6B64\\u7528\\u539F\\u578B\\u6A21\\u5F0F\\u5B9E\\u73B0\\u4E86\\u4EAB\\u5143\\u6A21\\u5F0F\\uFF0C\\u53EF\\u89C1\\u5F88\\u591A\\u8BBE\\u8BA1\\u6A21\\u5F0F\\u4E4B\\u95F4\\u662F\\u76F8\\u901A\\u7684\\uFF0C\\u800C\\u8FDE\\u901A\\u5B83\\u4EEC\\u7684\\u662F\\u4E3A\\u4E86\\u63D0\\u9AD8\\u4EE3\\u7801\\u53EF\\u7EF4\\u62A4\\u6027\\u7684\\u8BBE\\u8BA1\\u539F\\u5219\"), mdx(\"h2\", {\n    \"id\": \"使用场景\"\n  }, \"\\u4F7F\\u7528\\u573A\\u666F\"), mdx(\"p\", null, \"\\u4E00\\u822C\\u6765\\u8BF4\\uFF0C\\u4EE5\\u4E0B\\u60C5\\u51B5\\u53D1\\u751F\\u65F6\\u4FBF\\u53EF\\u4EE5\\u4F7F\\u7528\\u4EAB\\u5143\\u6A21\\u5F0F\\uFF1A\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u4E00\\u4E2A\\u7A0B\\u5E8F\\u4E2D\\u4F7F\\u7528\\u4E86\\u5927\\u91CF\\u7684\\u76F8\\u4F3C\\u5BF9\\u8C61\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u7531\\u4E8E\\u4F7F\\u7528\\u4E86\\u5927\\u91CF\\u5BF9\\u8C61\\uFF0C\\u9020\\u6210\\u5F88\\u5927\\u7684\\u5185\\u5B58\\u5F00\\u9500\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u5BF9\\u8C61\\u7684\\u5927\\u591A\\u6570\\u72B6\\u6001\\u90FD\\u53EF\\u4EE5\\u53D8\\u4E3A\\u5916\\u90E8\\u72B6\\u6001\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u5265\\u79BB\\u51FA\\u5BF9\\u8C61\\u7684\\u5916\\u90E8\\u72B6\\u6001\\u4E4B\\u540E\\uFF0C\\u53EF\\u4EE5\\u7528\\u76F8\\u5BF9\\u8F83\\u5C11\\u7684\\u5171\\u4EAB\\u5BF9\\u8C61\\u53D6\\u4EE3\\u5927\\u91CF\\u5BF9\\u8C61\"))), mdx(\"h2\", {\n    \"id\": \"对象池\"\n  }, \"\\u5BF9\\u8C61\\u6C60\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const objectPoolFactory = function (createObjFn) {\\n  const objectPool = []\\n\\n  return {\\n    create(...args) {\\n      const obj = objectPool.length === 0 \\n        ? createObjFn(...args)\\n        : objectPool.shift()\\n      return obj\\n    },\\n    recover(obj) {\\n      objectPool.push(obj)\\n    },\\n  }\\n}\\n\\n// using\\nconst iframeFactory = objectPoolFactory(function () {\\n  const iframe = document.createElement('iframe')\\n  document.body.appendChild(iframe)\\n  iframe.onload = function () {\\n    iframe.onload = null // \\u9632\\u6B62 iframe \\u91CD\\u590D\\u52A0\\u8F7D\\u7684 bug\\n    iframeFactory.recover(iframe) // iframe \\u52A0\\u8F7D\\u5B8C\\u6210\\u4E4B\\u540E\\u56DE\\u6536\\u8282\\u70B9\\n  }\\n  return iframe\\n})\\n\\nconst iframe1 = iframeFactory.create()\\niframe1.src = 'http://baidu.com'\\n\\nconst iframe2 = iframeFactory.create()\\niframe2.src = 'http://QQ.com'\\n\\nsetTimeout(() => {\\n  const iframe3 = iframeFactory.create()\\n  iframe3.src = 'http://163.com'\\n}, 3000)\\n\")), mdx(\"p\", null, \"\\u901A\\u8FC7\\u521B\\u5EFA\\u65F6\\u7684 create\\uFF0Conload \\u65F6\\u7684 recover\\uFF0C\\u5B9E\\u73B0\\u53EA\\u7528\\u4E00\\u4E2A iframe \\u5BF9\\u8C61\\u5728\\u7F51\\u9875\\u4E0A\\u521B\\u5EFA\\u591A\\u4E2A iframe\\uFF0C\\u51CF\\u5C0F\\u4E86\\u7A7A\\u95F4\\u4E0A\\u7684\\u635F\\u8017\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"slug":"/note/javascript-design-patterns-and-development-practices/shared"}},"staticQueryHashes":["318001574","3787687951","3787687951"]}